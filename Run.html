<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Run</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <details>
<summary> imports </summary>
<p>
<pre><code class="language-haskell">module Plutarch.Docs.Run (applyArguments, evalT, evalSerialize, evalWithArgsT, evalWithArgsT') where
import Data.Bifunctor (first)
import Data.ByteString.Short (ShortByteString)
import Data.Text (Text, pack)
import Plutarch.Internal.Term (ClosedTerm, compile)
import Plutarch.Script (Script (unScript), serialiseScript)
import Plutarch.Evaluate (evalScript, applyArguments)
import PlutusLedgerApi.V1 (Data, ExBudget)
import UntypedPlutusCore (DeBruijn, DefaultFun, DefaultUni, Program)
</code></pre>
</p>
</details>
This document describes how to compile and run Plutarch - whether for on chain deployment or off chain testing.
<blockquote>
<p>Note: If you spot any mistakes/have any related questions that this guide lacks the answer to, please don't hesitate to raise an issue. The goal is to have high quality documentation for Plutarch users!</p>
</blockquote>
<details>
<summary> Table of Contents </summary>
<ul>
<li><a href="#common-extensions-and-ghc-options">Common Extensions and GHC options</a></li>
<li><a href="#evaluation">Evaluation</a></li>
</ul>
</details>
<h1 id="common-extensions-and-ghc-options"><a class="header" href="#common-extensions-and-ghc-options">Common Extensions and GHC options</a></h1>
<p>You generally want to adhere to the same extensions and GHC options the <a href="https://github.com/Plutonomicon/plutarch/blob/master/plutarch.cabal">Plutarch repo</a> uses.</p>
<details>
<summary> List of GHC extensions </summary>
<ul>
<li><code>NoStarIsType</code></li>
<li><code>BangPatterns</code></li>
<li><code>BinaryLiterals</code></li>
<li><code>ConstrainedClassMethods</code></li>
<li><code>ConstraintKinds</code></li>
<li><code>DataKinds</code></li>
<li><code>DeriveAnyClass</code></li>
<li><code>DeriveDataTypeable</code></li>
<li><code>DeriveFoldable</code></li>
<li><code>DeriveFunctor</code></li>
<li><code>DeriveGeneric</code></li>
<li><code>DeriveLift</code></li>
<li><code>DeriveTraversable</code></li>
<li><code>DerivingStrategies</code></li>
<li><code>DerivingVia</code></li>
<li><code>DoAndIfThenElse</code></li>
<li><code>EmptyCase</code></li>
<li><code>EmptyDataDecls</code></li>
<li><code>EmptyDataDeriving</code></li>
<li><code>ExistentialQuantification</code></li>
<li><code>ExplicitForAll</code></li>
<li><code>FlexibleContexts</code></li>
<li><code>FlexibleInstances</code></li>
<li><code>ForeignFunctionInterface</code></li>
<li><code>GADTSyntax</code></li>
<li><code>GeneralisedNewtypeDeriving</code></li>
<li><code>HexFloatLiterals</code></li>
<li><code>ImplicitPrelude</code></li>
<li><code>InstanceSigs</code></li>
<li><code>KindSignatures</code></li>
<li><code>LambdaCase</code></li>
<li><code>MonomorphismRestriction</code></li>
<li><code>MultiParamTypeClasses</code></li>
<li><code>NamedFieldPuns</code></li>
<li><code>NamedWildCards</code></li>
<li><code>NumericUnderscores</code></li>
<li><code>OverloadedStrings</code></li>
<li><code>PartialTypeSignatures</code></li>
<li><code>PatternGuards</code></li>
<li><code>PolyKinds</code></li>
<li><code>PostfixOperators</code></li>
<li><code>RankNTypes</code></li>
<li><code>RelaxedPolyRec</code></li>
<li><code>ScopedTypeVariables</code></li>
<li><code>StandaloneDeriving</code></li>
<li><code>StandaloneKindSignatures</code></li>
<li><code>TraditionalRecordSyntax</code></li>
<li><code>TupleSections</code></li>
<li><code>TypeApplications</code></li>
<li><code>TypeFamilies</code></li>
<li><code>TypeOperators</code></li>
<li><code>TypeSynonymInstances</code></li>
<li><code>ViewPatterns</code></li>
</ul>
</details>
<h1 id="evaluation"><a class="header" href="#evaluation">Evaluation</a></h1>
<p>You can compile a Plutarch term using <code>compile</code> (from <code>Plutarch</code> module), making sure it has no free variables. <code>compile</code> returns a <code>Script</code>, which you can use as you would any other Plutus script.</p>
<blockquote>
<p>For further insight into what is compiled - you can use <code>Plutarch.Pretty.prettyTerm</code>.</p>
</blockquote>
<blockquote>
<p>Note: You can pretty much ignore the UPLC types involved here. All it really means is that the result is a "UPLC program". When it's printed, it's pretty legible - especially for debugging purposes. Although not necessary to use Plutarch, you may find the <a href="https://github.com/Plutonomicon/plutonomicon/blob/main/uplc.md">Plutonomicon UPLC guide</a> useful.</p>
</blockquote>
<pre><code class="language-haskell">evalSerialize :: ClosedTerm a -&gt; Either Text ShortByteString
evalSerialize x = serialiseScript . (\(a, _, _) -&gt; a) &lt;$&gt; evalT x

evalT :: ClosedTerm a -&gt; Either Text (Script, ExBudget, [Text])
evalT x = evalWithArgsT x []

evalWithArgsT :: ClosedTerm a -&gt; [Data] -&gt; Either Text (Script, ExBudget, [Text])
evalWithArgsT x args = do
  cmp &lt;- compile mempty x
  let (escr, budg, trc) = evalScript $ applyArguments cmp args
  scr &lt;- first (pack . show) escr
  pure (scr, budg, trc)

evalWithArgsT' :: ClosedTerm a -&gt; [Data] -&gt; Either Text (Program DeBruijn DefaultUni DefaultFun (), ExBudget, [Text])
evalWithArgsT' x args =
  (\(res, budg, trcs) -&gt; (unScript res, budg, trcs))
    &lt;$&gt; evalWithArgsT x args
</code></pre>
<p>Note there might be utilities already in Plutarch that replaces above functions.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="DEVGUIDE.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="Troubleshooting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="DEVGUIDE.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="Troubleshooting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
