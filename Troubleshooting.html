<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Troubleshooting</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p>Note: If you spot any mistakes/have any related questions that this guide lacks the answer to, please don't hesitate to raise an issue. The goal is to have high quality documentation for Plutarch users!</p>
</blockquote>
<details>
<summary> Table of Contents </summary>
<ul>
<li><a href="#no-instance-for-punsafeliftdecl-a">No instance for <code>PUnsafeLiftDecl a</code></a></li>
<li><a href="#couldnt-match-representation-of-type--arising-from-the-deriving-clause">Couldn't match representation of type: ... arising from the 'deriving' clause</a></li>
<li><a href="#infinite-loop--infinite-ast">Infinite loop / Infinite AST</a></li>
<li><a href="#couldnt-match-type-plutarchdatareprinternalpunlabel--arising-from-a-use-of-pfield-or-getfield-or-pletfields">Couldn't match type <code>Plutarch.DataRepr.Internal.PUnLabel ...</code> arising from a use of <code>pfield</code> (or <code>getField</code>, or <code>pletFields</code>)</a></li>
<li><a href="#expected-a-type-but-fieldname-has-kind-ghctypessymbol">Expected a type, but "fieldName" has kind <code>GHC.Types.Symbol</code></a></li>
<li><a href="#lifting-pasdata">Lifting <code>PAsData</code></a></li>
<li><a href="#type-match-errors-when-using-pfieldgetfield-or-overloadedrecorddot-to-access-field">Type match errors when using <code>pfield</code>/<code>getField</code> (or <code>OverloadedRecordDot</code> to access field)</a></li>
</ul>
</details>
<h1 id="no-instance-for-punsafeliftdecl-a"><a class="header" href="#no-instance-for-punsafeliftdecl-a">No instance for <code>PUnsafeLiftDecl a</code></a></h1>
<p>You should add <code>PLift a</code> to the context! <code>PLift</code> is just a synonym to <code>PUnsafeLiftDecl</code>.</p>
<h1 id="couldnt-match-representation-of-type--arising-from-the-deriving-clause"><a class="header" href="#couldnt-match-representation-of-type--arising-from-the-deriving-clause">Couldn't match representation of type: ... arising from the 'deriving' clause</a></h1>
<p>If you're getting these errors when deriving typeclasses using the machinery provided by Plutarch
(e.g. generic deriving of <code>PlutusType</code>) - it means you're missing a constructor import.</p>
<h1 id="infinite-loop--infinite-ast"><a class="header" href="#infinite-loop--infinite-ast">Infinite loop / Infinite AST</a></h1>
<p>While may not be immediately obvious, things like the following are a no-go in Plutarch:</p>
<pre><code class="language-haskell">f :: Term s (PInteger :--&gt; PInteger)
f = phoistAcyclic $ plam $ \n -&gt;
  pif (n #== 0)
    0
    (n + f # (n - 1))
</code></pre>
<p>The issue here is that the AST is infinitely large. Plutarch will try to traverse this AST and will in
the process not terminate, as there is no end to it. In these cases, consider using <code>pfix</code>.</p>
<p>Relevant issue: <a href="https://github.com/Plutonomicon/plutarch/issues/19">#19</a></p>
<h1 id="couldnt-match-type-plutarchdatareprinternalpunlabel--arising-from-a-use-of-pfield-getfield"><a class="header" href="#couldnt-match-type-plutarchdatareprinternalpunlabel--arising-from-a-use-of-pfield-getfield">Couldn't match type <code>Plutarch.DataRepr.Internal.PUnLabel ...</code> arising from a use of <code>pfield</code>, <code>getField</code>,</a></h1>
<p><code>pletFields</code>, <code>hrecField</code> (deprecated)</p>
<p>You might get some weird errors when using <code>pfield</code>/<code>getField</code>/<code>pletFields</code> like the above. Don't be scared! It just
means that the type application you used is incorrect. Specifically, the type application names a non-existent field.
Re-check the field name string you used in the type application for typos!</p>
<h1 id="expected-a-type-but-fieldname-has-kind-ghctypessymbol"><a class="header" href="#expected-a-type-but-fieldname-has-kind-ghctypessymbol">Expected a type, but "fieldName" has kind <code>GHC.Types.Symbol</code></a></h1>
<p>This just means the argument of a type application wasn't correctly promoted. Most likely arising from a usage of
<code>pletFields</code>. In the case of <code>pfield</code> and <code>getField</code>, the argument of type application should have kind <code>Symbol</code>.
A simple string literal representing the field name should work in this case. In the case of <code>pletFields</code>, the
argument of type application should have kind <code>[Symbol]</code> - a type level list of types with kind <code>Symbol</code>. When you use
a singleton list here, like <code>["foo"]</code> - it's actually parsed as something of <em>kind</em> <code>Type</code> (like <code>[a]</code>).</p>
<p>All you need to do, is put a <code>'</code> (quote) in front of the list, like so- <code>@'["foo"]</code>. This will promote the list
constructor to the type level.</p>
<h1 id="lifting-pasdata"><a class="header" href="#lifting-pasdata">Lifting <code>PAsData</code></a></h1>
<p>Don't try to lift a <code>PAsData</code> term! It's intentionally blocked and partial. The <code>PLift</code> instance for <code>PAsData</code> is
only there to make some important functionality work correctly. But the instance methods will simply <code>error</code> if used.
Instead, you should either use <code>pforgetData</code> and <code>plift</code> that, or extract the <code>Term s a</code> out of <code>Term s (PAsData a)</code>
using <code>pfromData</code> and <code>plift</code> that instead!</p>
<h1 id="type-match-errors-when-using-pfieldgetfield-or-overloadedrecorddot-or-hrecfielddeprecated-to-access-field"><a class="header" href="#type-match-errors-when-using-pfieldgetfield-or-overloadedrecorddot-or-hrecfielddeprecated-to-access-field">Type match errors when using <code>pfield</code>/<code>getField</code> (or <code>OverloadedRecordDot</code>, or <code>hrecField</code>(deprecated)) to access field</a></h1>
<p>You might get nonsensical "Couldn't match type" errors when extracting fields. This has to do with GHC
incorrectly inferring the return type. Field extraction is meant to be polymorphic in its return type in the sense that
it might either return a <code>Term s (PAsData p)</code> term, or simply a <code>Term s p</code> (automatic <code>pfromData</code>). Unfortunately,
sometimes this polymorphism makes it harder for GHC to infer the types. Also be aware that this automatic <code>pfromData</code>
will infer <code>PAsData</code>d terms more eagerly.</p>
<p>You can fix this by providing an explicit type annotation on <em>the result</em> of <code>pfield</code> or <code>getField</code> (or
<code>OverloadedRecordDot</code> for field access). Otherwise, you can also explicitly use <code>pfromData</code> on the result.
This will also help to make code more readable and is generally a good idea as plutarch validators and policies
tend to get very long and consequently confusing without explicit type annotations on the bound terms.</p>
<p>Relevant issue: <a href="https://github.com/Plutonomicon/plutarch/issues/275">#275</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Run.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="examples/BASIC.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Run.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="examples/BASIC.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
