<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Plutarch.Unroll</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">plutarch-1.10.0</span><ul class="links" id="page-menu"><li><a href="src/Plutarch.Unroll.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>GHC2021</td></tr></table><p class="caption">Plutarch.Unroll</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Unrolling a recursive function involves explicitly laying out some or all of the recursive steps, rather than relying on recursion via a fixed-point combinator.
In UPLC, the typical <code><a href="Plutarch-Internal-Fix.html#v:pfix" title="Plutarch.Internal.Fix">pfix</a></code> implementation uses a Y-combinator under the hood. Each recursive step incurs additional evaluation costs (CPU and memory) due to
the execution of the Y-combinator. By eliminating these costs in each recursive step, unrolled functions reduce execution overhead. However, since each recursive
step is explicitly laid out, unrolled functions consume more script size.</p><p>There are various unrolling strategies available. It is important to carefully study the implications of each strategy, as they may impose different requirements,
such as hard limit on recursion depth.</p><p>Generally for all strategies, calling the &quot;recursion step&quot;--that is <code>r</code> in <code>fix $ r a b ... -&gt; ...</code>--multiple times will result in exponential increase of the script
size in each step of unrolling. This is because everytime the recursion step is called, it generates UPLC code for that specific branch(and all the subsequent branches
down the unrolling!). To prevent this, it is possible to have <code>plet r $ r' -&gt; <a href="..r'">can be used multiple times..</a></code>.</p><p>Also, due to some of the other optimization performed; specifically <code>pmatch</code>'s branch detection which requires hashing terms of all subsequent deconstruction branches,
only tail-call recursion would perform fast enough to be used for large unrolling.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:punrollBound">punrollBound</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)</li><li class="src short"><a href="#v:punrollBound-39-">punrollBound'</a> :: <span class="keyword">forall</span> a b c s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; ((c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)</li><li class="src short"><a href="#v:punrollUnbound">punrollUnbound</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)</li><li class="src short"><a href="#v:punrollUnboundWhole">punrollUnboundWhole</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:punrollBound" class="def">punrollBound</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) <a href="src/Plutarch.Unroll.html#punrollBound" class="link">Source</a> <a href="#v:punrollBound" class="selflink">#</a></p><div class="doc"><p>This is simplified version of <code>punrollBound'</code> without doing additional recursion on Haskell level value.</p><p><em>Since: 1.10.0</em></p></div></div><div class="top"><p class="src"><a id="v:punrollBound-39-" class="def">punrollBound'</a> :: <span class="keyword">forall</span> a b c s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; ((c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; c -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) <a href="src/Plutarch.Unroll.html#punrollBound%27" class="link">Source</a> <a href="#v:punrollBound-39-" class="selflink">#</a></p><div class="doc"><p>The first argument specifies the unrolling depth.
The second argument defines the fallback behavior when the recursion depth exceeds the provided unrolling depth.</p><p>The fixed-point implementation provided requires a Haskell-level value <code>c</code> and a Plutarch function of type `Term s (a :--&gt; b)`. The functional for the recursion is passed as a Haskell function.
The inclusion of the additional, arbitrary Haskell value (typed <code>c</code>) enables further optimization by allowing pre-computation of constant values that depend only on the recursion depth.</p><p>This function will be used in a very niche situations. Using Haskell-level value for constant replacement is only practical on a single branch recursion with constant value that needs to be added
on each step. <code>plength</code> is one of the niche use case.</p><p><em>Since: 1.10.0</em></p></div></div><div class="top"><p class="src"><a id="v:punrollUnbound" class="def">punrollUnbound</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) <a href="src/Plutarch.Unroll.html#punrollUnbound" class="link">Source</a> <a href="#v:punrollUnbound" class="selflink">#</a></p><div class="doc"><p>Unroll given amount of steps, and for rest, uses <code><a href="Plutarch-Internal-Fix.html#v:pfix" title="Plutarch.Internal.Fix">pfix</a></code> to support unbound recursion.</p><p><em>Since: 1.10.0</em></p></div></div><div class="top"><p class="src"><a id="v:punrollUnboundWhole" class="def">punrollUnboundWhole</a> :: <span class="keyword">forall</span> a b s. <a href="../../ghc-9.6.6/html/libraries/base-4.18.2.1/Prelude.html#t:Integer" title="Prelude">Integer</a> -&gt; (<a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b)) -&gt; <a href="Plutarch-Internal-Term.html#t:Term" title="Plutarch.Internal.Term">Term</a> s (a <a href="Plutarch-Internal-Term.html#t::-45--45--62-" title="Plutarch.Internal.Term">:--&gt;</a> b) <a href="src/Plutarch.Unroll.html#punrollUnboundWhole" class="link">Source</a> <a href="#v:punrollUnboundWhole" class="selflink">#</a></p><div class="doc"><p>Uses <code><a href="Plutarch-Internal-Fix.html#v:pfix" title="Plutarch.Internal.Fix">pfix</a></code> to recurse unrolled function itself. Unlike <code>punrollUnbound</code>, this function uses unrolled instructions
within <code><a href="Plutarch-Internal-Fix.html#v:pfix" title="Plutarch.Internal.Fix">pfix</a></code> recursions.</p><p>This should perform better than <code>punrollUnbound</code> when a function requires a large recursion depth.</p><p><em>Since: 1.10.0</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>