<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs            #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase       #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies     #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators    #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns     #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="annot"><span class="hs-comment">{-| An inlining pass.

This pass is essentially a copy of the PIR inliner, and should be KEPT IN SYNC
with it. It's hard to do this with true abstraction, so we just have to keep
two copies reasonably similar.

However, there are some differences. In the interests of making it easier
to keep things in sync, these are explicitly listed in
Note [Differences from PIR inliner]. If you add another difference,
please note it there! Obviously fewer differences is better.

See Note [The problem of inlining destructors] for why this pass exists.
-}</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">UntypedPlutusCore.Transform.Inline</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier">inline</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="PlutusCore.Annotation.html#InlineHints"><span class="hs-identifier">InlineHints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forMOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeLenses</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(%~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Function.html#%26"><span class="hs-operator">(&amp;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ifM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&amp;&amp;^)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(||^)</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.html"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier">runReaderT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.html"><span class="hs-identifier">Control.Monad.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier">StateT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#evalStateT"><span class="hs-identifier">evalStateT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier">gets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#modify%27"><span class="hs-identifier">modify'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Annotation.html"><span class="hs-identifier">PlutusCore.Annotation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Annotation.html#Inline"><span class="hs-identifier">Inline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Annotation.html#AlwaysInline"><span class="hs-identifier">AlwaysInline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Annotation.html#SafeToInline"><span class="hs-identifier">SafeToInline</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Annotation.html#InlineHints"><span class="hs-identifier">InlineHints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.html"><span class="hs-identifier">PlutusCore.Builtin</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.MkPlc.html"><span class="hs-identifier">PlutusCore.MkPlc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#mkIterApp"><span class="hs-identifier">mkIterApp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html"><span class="hs-identifier">PlutusCore.Name.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier">HasUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier">TermUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#Unique"><span class="hs-identifier">Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.UniqueMap.html"><span class="hs-identifier">PlutusCore.Name.UniqueMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UMap</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier">MonadQuote</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier">Quote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html"><span class="hs-identifier">PlutusCore.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier">Dupable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier">dupable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier">liftDupable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Analysis.Usages.html"><span class="hs-identifier">UntypedPlutusCore.Analysis.Usages</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Usages</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.html"><span class="hs-identifier">UntypedPlutusCore.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Plated.html"><span class="hs-identifier">UntypedPlutusCore.Core.Plated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier">termSubterms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html"><span class="hs-identifier">UntypedPlutusCore.Core.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#termAnn"><span class="hs-identifier">termAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html"><span class="hs-identifier">UntypedPlutusCore.MkUPlc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier">UTermDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier">UVarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html"><span class="hs-identifier">UntypedPlutusCore.Purity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#EvalTerm"><span class="hs-identifier">EvalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#EvalTerm"><span class="hs-identifier">EvalTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#Unknown"><span class="hs-identifier">Unknown</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#Purity"><span class="hs-identifier">Purity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#MaybeImpure"><span class="hs-identifier">MaybeImpure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#Pure"><span class="hs-identifier">Pure</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#isPure"><span class="hs-identifier">isPure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>                                 </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#termEvaluationOrder"><span class="hs-identifier">termEvaluationOrder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Purity.html#unEvalOrder"><span class="hs-identifier">unEvalOrder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Rename.html"><span class="hs-identifier">UntypedPlutusCore.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Size.html"><span class="hs-identifier">UntypedPlutusCore.Size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Size.html#Size"><span class="hs-identifier">Size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Size.html#termSize"><span class="hs-identifier">termSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Subst.html"><span class="hs-identifier">UntypedPlutusCore.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Subst.html#termSubstNamesM"><span class="hs-identifier">termSubstNamesM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html"><span class="hs-identifier">UntypedPlutusCore.Transform.Simplifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html#SimplifierStage"><span class="hs-identifier">SimplifierStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html#Inline"><span class="hs-identifier">Inline</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html#SimplifierT"><span class="hs-identifier">SimplifierT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>                                               </span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html#recordSimplification"><span class="hs-identifier">recordSimplification</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Witherable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">wither</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">{- Note [Differences from PIR inliner]
See the module comment for explanation for why this exists and is similar to
the PIR inliner.

1. No types (obviously).
2. No strictness information (we only have lambda arguments, which are always
   strict).
3. Handling of multiple beta-reductions in one go, this is handled in PIR by a
   dedicated pass.
4. Simplistic purity analysis, in particular we don't try to be clever about
   builtins (should mostly be handled in PIR).
-}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- | Substitution range, 'SubstRng' in the paper.</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">newtype</span><span> </span><span id="InlineTerm"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-var">InlineTerm</span></a></span></span><span> </span><span id="local-6989586621681937059"><span class="annot"><a href="#local-6989586621681937059"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937060"><span class="annot"><a href="#local-6989586621681937060"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937061"><span class="annot"><a href="#local-6989586621681937061"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937062"><span class="annot"><a href="#local-6989586621681937062"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Done"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier hs-type">Dupable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937059"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937060"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937061"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937062"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><span class="hs-comment">{-| Term substitution, 'Subst' in the paper.
A map of unprocessed variable and its substitution range.
-}</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">newtype</span><span> </span><span id="TermEnv"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-var">TermEnv</span></a></span></span><span> </span><span id="local-6989586621681936559"><span class="annot"><a href="#local-6989586621681936559"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936560"><span class="annot"><a href="#local-6989586621681936560"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936561"><span class="annot"><a href="#local-6989586621681936561"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936562"><span class="annot"><a href="#local-6989586621681936562"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermEnv"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-var">TermEnv</span></a></span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">{</span><span id="_unTermEnv"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#_unTermEnv"><span class="hs-identifier hs-var hs-var">_unTermEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Name.UniqueMap.html#UniqueMap"><span class="hs-identifier hs-type">PLC.UniqueMap</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936559"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936560"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936561"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937247"><span id="local-6989586621681937252"><span id="local-6989586621681937258"><span class="annot"><span class="annottext">NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
(TermEnv name uni fun a
 -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a)
-&gt; (NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a)
-&gt; (forall b.
    Integral b =&gt;
    b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a)
-&gt; Semigroup (TermEnv name uni fun a)
forall b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall name (uni :: * -&gt; *) fun a.
NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$c&lt;&gt; :: forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
&lt;&gt; :: TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$csconcat :: forall name (uni :: * -&gt; *) fun a.
NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
sconcat :: NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
$cstimes :: forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
stimes :: forall b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Semigroup"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937268"><span id="local-6989586621681937273"><span id="local-6989586621681937277"><span class="annot"><span class="annottext">Semigroup (TermEnv name uni fun a)
TermEnv name uni fun a
Semigroup (TermEnv name uni fun a) =&gt;
TermEnv name uni fun a
-&gt; (TermEnv name uni fun a
    -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a)
-&gt; ([TermEnv name uni fun a] -&gt; TermEnv name uni fun a)
-&gt; Monoid (TermEnv name uni fun a)
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall name (uni :: * -&gt; *) fun a.
Semigroup (TermEnv name uni fun a)
forall name (uni :: * -&gt; *) fun a. TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$cmempty :: forall name (uni :: * -&gt; *) fun a. TermEnv name uni fun a
mempty :: TermEnv name uni fun a
$cmappend :: forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
mappend :: TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$cmconcat :: forall name (uni :: * -&gt; *) fun a.
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
mconcat :: [TermEnv name uni fun a] -&gt; TermEnv name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Monoid"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><span class="hs-comment">{-| Wrapper of term substitution so that it's similar to the PIR inliner.
See Note [Differences from PIR inliner] 1
-}</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">newtype</span><span> </span><span id="Subst"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span id="local-6989586621681936599"><span class="annot"><a href="#local-6989586621681936599"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936600"><span class="annot"><a href="#local-6989586621681936600"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936601"><span class="annot"><a href="#local-6989586621681936601"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936602"><span class="annot"><a href="#local-6989586621681936602"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Subst"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span class="hs-special">{</span><span id="_termEnv"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a -&gt; TermEnv name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_termEnv"><span class="hs-identifier hs-var hs-var">_termEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-type">TermEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936599"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936600"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936601"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936602"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937284"><span id="local-6989586621681937286"><span class="annot"><span class="annottext">(forall x. Subst name uni fun a -&gt; Rep (Subst name uni fun a) x)
-&gt; (forall x. Rep (Subst name uni fun a) x -&gt; Subst name uni fun a)
-&gt; Generic (Subst name uni fun a)
forall x. Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
forall x. Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall name (uni :: * -&gt; *) fun a x.
Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a x.
Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
$cfrom :: forall name (uni :: * -&gt; *) fun a x.
Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
from :: forall x. Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
$cto :: forall name (uni :: * -&gt; *) fun a x.
Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
to :: forall x. Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937290"><span id="local-6989586621681937294"><span id="local-6989586621681937300"><span class="annot"><span class="annottext">NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
(Subst name uni fun a
 -&gt; Subst name uni fun a -&gt; Subst name uni fun a)
-&gt; (NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a)
-&gt; (forall b.
    Integral b =&gt;
    b -&gt; Subst name uni fun a -&gt; Subst name uni fun a)
-&gt; Semigroup (Subst name uni fun a)
forall b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall name (uni :: * -&gt; *) fun a.
NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
$c&lt;&gt; :: forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
&lt;&gt; :: Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
$csconcat :: forall name (uni :: * -&gt; *) fun a.
NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
sconcat :: NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
$cstimes :: forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
stimes :: forall b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Semigroup"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937309"><span id="local-6989586621681937313"><span id="local-6989586621681937317"><span class="annot"><span class="annottext">Semigroup (Subst name uni fun a)
Subst name uni fun a
Semigroup (Subst name uni fun a) =&gt;
Subst name uni fun a
-&gt; (Subst name uni fun a
    -&gt; Subst name uni fun a -&gt; Subst name uni fun a)
-&gt; ([Subst name uni fun a] -&gt; Subst name uni fun a)
-&gt; Monoid (Subst name uni fun a)
[Subst name uni fun a] -&gt; Subst name uni fun a
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall name (uni :: * -&gt; *) fun a. Semigroup (Subst name uni fun a)
forall name (uni :: * -&gt; *) fun a. Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
[Subst name uni fun a] -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
$cmempty :: forall name (uni :: * -&gt; *) fun a. Subst name uni fun a
mempty :: Subst name uni fun a
$cmappend :: forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
mappend :: Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
$cmconcat :: forall name (uni :: * -&gt; *) fun a.
[Subst name uni fun a] -&gt; Subst name uni fun a
mconcat :: [Subst name uni fun a] -&gt; Subst name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Monoid"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span id="local-6989586621681936559"><span id="local-6989586621681936560"><span id="local-6989586621681936561"><span id="local-6989586621681936562"><span id="local-6989586621681936640"><span id="local-6989586621681936641"><span id="local-6989586621681936642"><span id="local-6989586621681936643"><span id="unTermEnv"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">TermEnv</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-86"></span><span id="local-6989586621681936599"><span id="local-6989586621681936600"><span id="local-6989586621681936601"><span id="local-6989586621681936602"><span id="local-6989586621681936659"><span id="local-6989586621681936660"><span id="local-6989586621681936661"><span id="local-6989586621681936662"><span id="termEnv"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Subst</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">data</span><span> </span><span id="VarInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-var">VarInfo</span></a></span></span><span> </span><span id="local-6989586621681936673"><span class="annot"><a href="#local-6989586621681936673"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936674"><span class="annot"><a href="#local-6989586621681936674"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936675"><span class="annot"><a href="#local-6989586621681936675"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936676"><span class="annot"><a href="#local-6989586621681936676"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VarInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-var">VarInfo</span></a></span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_varBinders"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
VarInfo name uni fun ann -&gt; [name]
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varBinders"><span class="hs-identifier hs-var hs-var">_varBinders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681936673"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Lambda binders in the RHS (definition) of the variable.</span></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_varRhs"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
VarInfo name uni fun ann -&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varRhs"><span class="hs-identifier hs-var hs-var">_varRhs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936673"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936674"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936675"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936676"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The RHS (definition) of the variable.</span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_varRhsBody"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
VarInfo name uni fun ann -&gt; InlineTerm name uni fun ann
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varRhsBody"><span class="hs-identifier hs-var hs-var">_varRhsBody</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936673"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936674"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936675"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936676"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-comment">{- ^ The body of the RHS of the variable (i.e., RHS minus the binders).
  Using 'InlineTerm' here to ensure the body is renamed when inlined.
  -}</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span id="local-6989586621681936673"><span id="local-6989586621681936674"><span id="local-6989586621681936675"><span id="local-6989586621681936676"><span id="varBinders"><span id="varRhs"><span id="varRhsBody"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">VarInfo</span></span></span></span></span></span></span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- | UPLC inliner state</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">data</span><span> </span><span id="S"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span> </span><span id="local-6989586621681936710"><span class="annot"><a href="#local-6989586621681936710"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936711"><span class="annot"><a href="#local-6989586621681936711"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936712"><span class="annot"><a href="#local-6989586621681936712"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936713"><span class="annot"><a href="#local-6989586621681936713"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="S"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_subst"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
S name uni fun a -&gt; Subst name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_subst"><span class="hs-identifier hs-var hs-var">_subst</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936710"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936711"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936712"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936713"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_vars"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
S name uni fun a -&gt; UniqueMap TermUnique (VarInfo name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#_vars"><span class="hs-identifier hs-var hs-var">_vars</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Name.UniqueMap.html#UniqueMap"><span class="hs-identifier hs-type">PLC.UniqueMap</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936710"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936711"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936712"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936713"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span id="local-6989586621681936710"><span id="local-6989586621681936711"><span id="local-6989586621681936712"><span id="local-6989586621681936713"><span id="subst"><span id="vars"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">S</span></span></span></span></span></span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681936738"><span id="local-6989586621681936739"><span id="local-6989586621681936740"><span id="local-6989586621681936741"><span id="local-6989586621681937382"><span id="local-6989586621681937386"><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936738"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936739"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936741"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621681937392"><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681937392"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621681937393"><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
</span><a href="#local-6989586621681937393"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681937394"><span class="annot"><span class="annottext">&lt;&gt; :: S name uni fun a -&gt; S name uni fun a -&gt; S name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621681937395"><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681937395"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621681937396"><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
</span><a href="#local-6989586621681937396"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; S name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681937392"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681937395"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
</span><a href="#local-6989586621681937393"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
</span><a href="#local-6989586621681937396"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681936746"><span id="local-6989586621681936747"><span id="local-6989586621681936748"><span id="local-6989586621681936749"><span id="local-6989586621681937401"><span id="local-6989586621681937405"><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936746"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936747"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936748"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936749"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621681937409"><span class="annot"><span class="annottext">mempty :: S name uni fun a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; S name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueMap TermUnique (VarInfo name uni fun a)
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">type</span><span> </span><span id="ExternalConstraints"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#ExternalConstraints"><span class="hs-identifier hs-var">ExternalConstraints</span></a></span></span><span> </span><span id="local-6989586621681937410"><span class="annot"><a href="#local-6989586621681937410"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937411"><span class="annot"><a href="#local-6989586621681937411"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937412"><span class="annot"><a href="#local-6989586621681937412"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937413"><span class="annot"><a href="#local-6989586621681937413"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937410"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937410"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937411"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937412"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937413"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">type</span><span> </span><span id="InliningConstraints"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-var">InliningConstraints</span></a></span></span><span> </span><span id="local-6989586621681937414"><span class="annot"><a href="#local-6989586621681937414"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937415"><span class="annot"><a href="#local-6989586621681937415"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937416"><span class="annot"><a href="#local-6989586621681937416"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937414"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937414"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937415"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937416"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- See Note [Differences from PIR inliner] 2</span><span>
</span><span id="line-129"></span><span class="hs-keyword">data</span><span> </span><span id="InlineInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-var">InlineInfo</span></a></span></span><span> </span><span id="local-6989586621681936750"><span class="annot"><a href="#local-6989586621681936750"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936751"><span class="annot"><a href="#local-6989586621681936751"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936752"><span class="annot"><a href="#local-6989586621681936752"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InlineInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-var">InlineInfo</span></a></span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_iiUsages"><span class="annot"><span class="annottext">forall name fun a. InlineInfo name fun a -&gt; Usages
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiUsages"><span class="hs-identifier hs-var hs-var">_iiUsages</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages.Usages</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_iiHints"><span class="annot"><span class="annottext">forall name fun a. InlineInfo name fun a -&gt; InlineHints name a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiHints"><span class="hs-identifier hs-var hs-var">_iiHints</span></a></span></span><span>                   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Annotation.html#InlineHints"><span class="hs-identifier hs-type">InlineHints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936750"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936752"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_iiBuiltinSemanticsVariant"><span class="annot"><span class="annottext">forall name fun a.
InlineInfo name fun a -&gt; BuiltinSemanticsVariant fun
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiBuiltinSemanticsVariant"><span class="hs-identifier hs-var hs-var">_iiBuiltinSemanticsVariant</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinSemanticsVariant"><span class="hs-identifier hs-type">PLC.BuiltinSemanticsVariant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936751"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_iiInlineConstants"><span class="annot"><span class="annottext">forall name fun a. InlineInfo name fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiInlineConstants"><span class="hs-identifier hs-var hs-var">_iiInlineConstants</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_iiInlineCallsiteGrowth"><span class="annot"><span class="annottext">forall name fun a. InlineInfo name fun a -&gt; Size
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiInlineCallsiteGrowth"><span class="hs-identifier hs-var hs-var">_iiInlineCallsiteGrowth</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Size.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span id="local-6989586621681936750"><span id="local-6989586621681936751"><span id="local-6989586621681936752"><span id="local-6989586621681936773"><span id="local-6989586621681936774"><span id="local-6989586621681936775"><span id="iiBuiltinSemanticsVariant"><span id="iiHints"><span id="iiInlineCallsiteGrowth"><span id="iiInlineConstants"><span id="iiUsages"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">InlineInfo</span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- Using a concrete monad makes a very large difference to the performance</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- of this module (determined from profiling)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-comment">-- | The monad the inliner runs in.</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">type</span><span> </span><span id="InlineM"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-var">InlineM</span></a></span></span><span> </span><span id="local-6989586621681937474"><span class="annot"><a href="#local-6989586621681937474"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937475"><span class="annot"><a href="#local-6989586621681937475"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937476"><span class="annot"><a href="#local-6989586621681937476"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937477"><span class="annot"><a href="#local-6989586621681937477"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-type">InlineInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937474"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937476"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937477"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937474"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937475"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937476"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937477"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-comment">-- | Look up the unprocessed variable in the substitution.</span></span><span>
</span><span id="line-147"></span><span id="local-6989586621681936799"><span id="local-6989586621681936801"><span id="local-6989586621681936802"><span id="local-6989586621681936803"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-type">lookupTerm</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936799"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681936799"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936799"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936801"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936802"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936803"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936799"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936801"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936802"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936803"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-152"></span><span id="lookupTerm"><span class="annot"><span class="annottext">lookupTerm :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; S name uni fun a -&gt; Maybe (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-var hs-var">lookupTerm</span></a></span></span><span> </span><span id="local-6989586621681937488"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937488"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937489"><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937489"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">name
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
-&gt; Maybe (InlineTerm name uni fun a)
forall name unique a.
HasUnique name unique =&gt;
name -&gt; UniqueMap unique a -&gt; Maybe a
</span><a href="PlutusCore.Name.UniqueMap.html#lookupName"><span class="hs-identifier hs-var">UMap.lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937488"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueMap TermUnique (InlineTerm name uni fun a)
 -&gt; Maybe (InlineTerm name uni fun a))
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
-&gt; Maybe (InlineTerm name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937489"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
-&gt; Getting
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (S name uni fun a)
     (UniqueMap TermUnique (InlineTerm name uni fun a))
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(Subst name uni fun a
 -&gt; Const
      (UniqueMap TermUnique (InlineTerm name uni fun a))
      (Subst name uni fun a))
-&gt; S name uni fun a
-&gt; Const
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (S name uni fun a)
forall name (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(Subst name uni fun a -&gt; f (Subst name uni fun a))
-&gt; S name uni fun a -&gt; f (S name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">((Subst name uni fun a
  -&gt; Const
       (UniqueMap TermUnique (InlineTerm name uni fun a))
       (Subst name uni fun a))
 -&gt; S name uni fun a
 -&gt; Const
      (UniqueMap TermUnique (InlineTerm name uni fun a))
      (S name uni fun a))
-&gt; ((UniqueMap TermUnique (InlineTerm name uni fun a)
     -&gt; Const
          (UniqueMap TermUnique (InlineTerm name uni fun a))
          (UniqueMap TermUnique (InlineTerm name uni fun a)))
    -&gt; Subst name uni fun a
    -&gt; Const
         (UniqueMap TermUnique (InlineTerm name uni fun a))
         (Subst name uni fun a))
-&gt; Getting
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (S name uni fun a)
     (UniqueMap TermUnique (InlineTerm name uni fun a))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEnv name uni fun a
 -&gt; Const
      (UniqueMap TermUnique (InlineTerm name uni fun a))
      (TermEnv name uni fun a))
-&gt; Subst name uni fun a
-&gt; Const
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (Subst name uni fun a)
forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a
       (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (TermEnv name uni fun a) (f (TermEnv name uni fun a))
-&gt; p (Subst name uni fun a) (f (Subst name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#termEnv"><span class="hs-identifier hs-var">termEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TermEnv name uni fun a
  -&gt; Const
       (UniqueMap TermUnique (InlineTerm name uni fun a))
       (TermEnv name uni fun a))
 -&gt; Subst name uni fun a
 -&gt; Const
      (UniqueMap TermUnique (InlineTerm name uni fun a))
      (Subst name uni fun a))
-&gt; ((UniqueMap TermUnique (InlineTerm name uni fun a)
     -&gt; Const
          (UniqueMap TermUnique (InlineTerm name uni fun a))
          (UniqueMap TermUnique (InlineTerm name uni fun a)))
    -&gt; TermEnv name uni fun a
    -&gt; Const
         (UniqueMap TermUnique (InlineTerm name uni fun a))
         (TermEnv name uni fun a))
-&gt; (UniqueMap TermUnique (InlineTerm name uni fun a)
    -&gt; Const
         (UniqueMap TermUnique (InlineTerm name uni fun a))
         (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; Subst name uni fun a
-&gt; Const
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (Subst name uni fun a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueMap TermUnique (InlineTerm name uni fun a)
 -&gt; Const
      (UniqueMap TermUnique (InlineTerm name uni fun a))
      (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; TermEnv name uni fun a
-&gt; Const
     (UniqueMap TermUnique (InlineTerm name uni fun a))
     (TermEnv name uni fun a)
forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a
       (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (UniqueMap TermUnique (InlineTerm name uni fun a))
  (f (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; p (TermEnv name uni fun a) (f (TermEnv name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#unTermEnv"><span class="hs-identifier hs-var">unTermEnv</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-comment">-- | Insert the unprocessed variable into the substitution.</span></span><span>
</span><span id="line-155"></span><span id="local-6989586621681936822"><span id="local-6989586621681936823"><span id="local-6989586621681936824"><span id="local-6989586621681936825"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-type">extendTerm</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936822"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681936822"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The name of the variable.</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936822"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936823"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936824"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936825"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The substitution range.</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936822"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936823"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936824"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936825"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The substitution.</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936822"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936823"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936824"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936825"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-164"></span><span id="extendTerm"><span class="annot"><span class="annottext">extendTerm :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; InlineTerm name uni fun a
-&gt; S name uni fun a
-&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-var hs-var">extendTerm</span></a></span></span><span> </span><span id="local-6989586621681937501"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937501"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937502"><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681937502"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span id="local-6989586621681937503"><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937503"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937503"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
-&gt; (S name uni fun a -&gt; S name uni fun a) -&gt; S name uni fun a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Subst name uni fun a -&gt; Identity (Subst name uni fun a))
-&gt; S name uni fun a -&gt; Identity (S name uni fun a)
forall name (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(Subst name uni fun a -&gt; f (Subst name uni fun a))
-&gt; S name uni fun a -&gt; f (S name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">((Subst name uni fun a -&gt; Identity (Subst name uni fun a))
 -&gt; S name uni fun a -&gt; Identity (S name uni fun a))
-&gt; ((UniqueMap TermUnique (InlineTerm name uni fun a)
     -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
    -&gt; Subst name uni fun a -&gt; Identity (Subst name uni fun a))
-&gt; (UniqueMap TermUnique (InlineTerm name uni fun a)
    -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; S name uni fun a
-&gt; Identity (S name uni fun a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEnv name uni fun a -&gt; Identity (TermEnv name uni fun a))
-&gt; Subst name uni fun a -&gt; Identity (Subst name uni fun a)
forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a
       (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (TermEnv name uni fun a) (f (TermEnv name uni fun a))
-&gt; p (Subst name uni fun a) (f (Subst name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#termEnv"><span class="hs-identifier hs-var">termEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TermEnv name uni fun a -&gt; Identity (TermEnv name uni fun a))
 -&gt; Subst name uni fun a -&gt; Identity (Subst name uni fun a))
-&gt; ((UniqueMap TermUnique (InlineTerm name uni fun a)
     -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
    -&gt; TermEnv name uni fun a -&gt; Identity (TermEnv name uni fun a))
-&gt; (UniqueMap TermUnique (InlineTerm name uni fun a)
    -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; Subst name uni fun a
-&gt; Identity (Subst name uni fun a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueMap TermUnique (InlineTerm name uni fun a)
 -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; TermEnv name uni fun a -&gt; Identity (TermEnv name uni fun a)
forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a
       (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (UniqueMap TermUnique (InlineTerm name uni fun a))
  (f (UniqueMap TermUnique (InlineTerm name uni fun a)))
-&gt; p (TermEnv name uni fun a) (f (TermEnv name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#unTermEnv"><span class="hs-identifier hs-var">unTermEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((UniqueMap TermUnique (InlineTerm name uni fun a)
  -&gt; Identity (UniqueMap TermUnique (InlineTerm name uni fun a)))
 -&gt; S name uni fun a -&gt; Identity (S name uni fun a))
-&gt; (UniqueMap TermUnique (InlineTerm name uni fun a)
    -&gt; UniqueMap TermUnique (InlineTerm name uni fun a))
-&gt; S name uni fun a
-&gt; S name uni fun a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">name
-&gt; InlineTerm name uni fun a
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
forall name unique a.
HasUnique name unique =&gt;
name -&gt; a -&gt; UniqueMap unique a -&gt; UniqueMap unique a
</span><a href="PlutusCore.Name.UniqueMap.html#insertByName"><span class="hs-identifier hs-var">UMap.insertByName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937501"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681937502"><span class="hs-identifier hs-var">clos</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span id="local-6989586621681936841"><span id="local-6989586621681936842"><span id="local-6989586621681936843"><span id="local-6989586621681936844"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#lookupVarInfo"><span class="hs-identifier hs-type">lookupVarInfo</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936841"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681936841"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936841"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936842"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936843"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936844"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936841"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936842"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936843"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936844"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-172"></span><span id="lookupVarInfo"><span class="annot"><span class="annottext">lookupVarInfo :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; S name uni fun a -&gt; Maybe (VarInfo name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupVarInfo"><span class="hs-identifier hs-var hs-var">lookupVarInfo</span></a></span></span><span> </span><span id="local-6989586621681937509"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937509"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937510"><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937510"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">name
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; Maybe (VarInfo name uni fun a)
forall name unique a.
HasUnique name unique =&gt;
name -&gt; UniqueMap unique a -&gt; Maybe a
</span><a href="PlutusCore.Name.UniqueMap.html#lookupName"><span class="hs-identifier hs-var">UMap.lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937509"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueMap TermUnique (VarInfo name uni fun a)
 -&gt; Maybe (VarInfo name uni fun a))
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; Maybe (VarInfo name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937510"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
-&gt; Getting
     (UniqueMap TermUnique (VarInfo name uni fun a))
     (S name uni fun a)
     (UniqueMap TermUnique (VarInfo name uni fun a))
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (UniqueMap TermUnique (VarInfo name uni fun a))
  (S name uni fun a)
  (UniqueMap TermUnique (VarInfo name uni fun a))
forall name (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(UniqueMap TermUnique (VarInfo name uni fun a)
 -&gt; f (UniqueMap TermUnique (VarInfo name uni fun a)))
-&gt; S name uni fun a -&gt; f (S name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621681936849"><span id="local-6989586621681936850"><span id="local-6989586621681936851"><span id="local-6989586621681936852"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#extendVarInfo"><span class="hs-identifier hs-type">extendVarInfo</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.Unique.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936849"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.Unique.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681936849"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936849"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936850"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936851"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936852"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936849"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936850"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936851"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936852"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936849"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936850"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936851"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936852"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-180"></span><span id="extendVarInfo"><span class="annot"><span class="annottext">extendVarInfo :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; VarInfo name uni fun a -&gt; S name uni fun a -&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendVarInfo"><span class="hs-identifier hs-var hs-var">extendVarInfo</span></a></span></span><span> </span><span id="local-6989586621681937515"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937515"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937516"><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937516"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681937517"><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937517"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">S name uni fun a
</span><a href="#local-6989586621681937517"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
-&gt; (S name uni fun a -&gt; S name uni fun a) -&gt; S name uni fun a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueMap TermUnique (VarInfo name uni fun a)
 -&gt; Identity (UniqueMap TermUnique (VarInfo name uni fun a)))
-&gt; S name uni fun a -&gt; Identity (S name uni fun a)
forall name (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(UniqueMap TermUnique (VarInfo name uni fun a)
 -&gt; f (UniqueMap TermUnique (VarInfo name uni fun a)))
-&gt; S name uni fun a -&gt; f (S name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">((UniqueMap TermUnique (VarInfo name uni fun a)
  -&gt; Identity (UniqueMap TermUnique (VarInfo name uni fun a)))
 -&gt; S name uni fun a -&gt; Identity (S name uni fun a))
-&gt; (UniqueMap TermUnique (VarInfo name uni fun a)
    -&gt; UniqueMap TermUnique (VarInfo name uni fun a))
-&gt; S name uni fun a
-&gt; S name uni fun a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">name
-&gt; VarInfo name uni fun a
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
-&gt; UniqueMap TermUnique (VarInfo name uni fun a)
forall name unique a.
HasUnique name unique =&gt;
name -&gt; a -&gt; UniqueMap unique a -&gt; UniqueMap unique a
</span><a href="PlutusCore.Name.UniqueMap.html#insertByName"><span class="hs-identifier hs-var">UMap.insertByName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937515"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937516"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><span class="hs-comment">{-| Inline simple bindings. Relies on global uniqueness, and preserves it.
See Note [Inlining and global uniqueness]
-}</span></span><span>
</span><span id="line-185"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier hs-type">inline</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681936857"><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936858"><span class="annot"><a href="#local-6989586621681936858"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936859"><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936860"><span class="annot"><a href="#local-6989586621681936860"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681936862"><span class="annot"><a href="#local-6989586621681936862"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-187"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#ExternalConstraints"><span class="hs-identifier hs-type">ExternalConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936858"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936860"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Size.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ inline threshold</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ inline constants</span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Annotation.html#InlineHints"><span class="hs-identifier hs-type">InlineHints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936862"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinSemanticsVariant"><span class="hs-identifier hs-type">PLC.BuiltinSemanticsVariant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936858"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936862"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Simplifier.html#SimplifierT"><span class="hs-identifier hs-type">SimplifierT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936858"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936862"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936860"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936857"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936858"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936859"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936862"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span id="inline"><span class="annot"><span class="annottext">inline :: forall name (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
ExternalConstraints name uni fun m =&gt;
Size
-&gt; Bool
-&gt; InlineHints name a
-&gt; BuiltinSemanticsVariant fun
-&gt; Term name uni fun a
-&gt; SimplifierT name uni fun a m (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span id="local-6989586621681937539"><span class="annot"><span class="annottext">Size
</span><a href="#local-6989586621681937539"><span class="hs-identifier hs-var">callsiteGrowth</span></a></span></span><span> </span><span id="local-6989586621681937540"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937540"><span class="hs-identifier hs-var">inlineConstants</span></a></span></span><span> </span><span id="local-6989586621681937541"><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681937541"><span class="hs-identifier hs-var">hints</span></a></span></span><span> </span><span id="local-6989586621681937542"><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937542"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span></span><span> </span><span id="local-6989586621681937543"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937543"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621681937544"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937544"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Quote (Term name uni fun a)
-&gt; SimplifierT name uni fun a m (Term name uni fun a)
forall a. Quote a -&gt; SimplifierT name uni fun a m a
forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="annot"><span class="annottext">(Quote (Term name uni fun a)
 -&gt; SimplifierT name uni fun a m (Term name uni fun a))
-&gt; Quote (Term name uni fun a)
-&gt; SimplifierT name uni fun a m (Term name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">(StateT (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
 -&gt; S name uni fun a -&gt; Quote (Term name uni fun a))
-&gt; S name uni fun a
-&gt; StateT
     (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
-&gt; Quote (Term name uni fun a)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
-&gt; S name uni fun a -&gt; Quote (Term name uni fun a)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#evalStateT"><span class="hs-identifier hs-var">evalStateT</span></a></span><span> </span><span class="annot"><span class="annottext">S name uni fun a
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
 -&gt; Quote (Term name uni fun a))
-&gt; StateT
     (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
-&gt; Quote (Term name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  (Term name uni fun a)
-&gt; InlineInfo name fun a
-&gt; StateT
     (S name uni fun a) (QuoteT Identity) (Term name uni fun a)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937543"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-type">InlineInfo</span></a></span><span>
</span><span id="line-203"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_iiUsages :: Usages
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiUsages"><span class="hs-identifier hs-var">_iiUsages</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Usages
forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
Term name uni fun a -&gt; Usages
</span><a href="UntypedPlutusCore.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">Usages.termUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937543"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_iiHints :: InlineHints name a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiHints"><span class="hs-identifier hs-var">_iiHints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681937541"><span class="hs-identifier hs-var">hints</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_iiBuiltinSemanticsVariant :: BuiltinSemanticsVariant fun
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiBuiltinSemanticsVariant"><span class="hs-identifier hs-var">_iiBuiltinSemanticsVariant</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937542"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_iiInlineConstants :: Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiInlineConstants"><span class="hs-identifier hs-var">_iiInlineConstants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937540"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_iiInlineCallsiteGrowth :: Size
</span><a href="UntypedPlutusCore.Transform.Inline.html#_iiInlineCallsiteGrowth"><span class="hs-identifier hs-var">_iiInlineCallsiteGrowth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Size
</span><a href="#local-6989586621681937539"><span class="hs-identifier hs-var">callsiteGrowth</span></a></span><span>
</span><span id="line-208"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; SimplifierStage
-&gt; Term name uni fun a
-&gt; SimplifierT name uni fun a m ()
forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
Monad m =&gt;
Term name uni fun a
-&gt; SimplifierStage
-&gt; Term name uni fun a
-&gt; SimplifierT name uni fun a m ()
</span><a href="UntypedPlutusCore.Transform.Simplifier.html#recordSimplification"><span class="hs-identifier hs-var">recordSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937543"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SimplifierStage
</span><a href="UntypedPlutusCore.Transform.Simplifier.html#Inline"><span class="hs-identifier hs-var">Inline</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937544"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; SimplifierT name uni fun a m (Term name uni fun a)
forall a. a -&gt; SimplifierT name uni fun a m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937544"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- See Note [Differences from PIR inliner] 3</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><span class="hs-comment">{-| Extract the list of applications from a term,
a bit like a &quot;multi-beta&quot; reduction.

Some examples will help:
[(\x . t) a] -&gt; Just ([(x, a)], t)

[[[(\x . (\y . (\z . t))) a] b] c] -&gt; Just ([(x, a), (y, b), (z, c)]) t)

[[(\x . t) a] b] -&gt; Nothing
-}</span></span><span>
</span><span id="line-224"></span><span id="local-6989586621681936917"><span id="local-6989586621681936918"><span id="local-6989586621681936919"><span id="local-6989586621681936920"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-type">extractApps</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936917"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936918"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936919"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936920"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936917"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936918"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936919"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936920"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936917"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936918"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936919"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936920"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-227"></span><span id="extractApps"><span class="annot"><span class="annottext">extractApps :: forall name (uni :: * -&gt; *) fun a.
Term name uni fun a
-&gt; Maybe ([UTermDef name uni fun a], Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-var hs-var">extractApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun a]
-&gt; Term name uni fun a
-&gt; Maybe
     ([Def (UVarDecl name a) (Term name uni fun a)],
      Term name uni fun a)
forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681937550"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621681937550"><span class="annot"><span class="annottext">go :: [Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681937550"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681937551"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937551"><span class="hs-identifier hs-var">argStack</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937553"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937553"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681937554"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937554"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681937550"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937554"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
-&gt; [Term name uni fun ann] -&gt; [Term name uni fun ann]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937551"><span class="hs-identifier hs-var">argStack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937553"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><a href="#local-6989586621681937550"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681937555"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937555"><span class="hs-identifier hs-var">argStack</span></a></span></span><span> </span><span id="local-6989586621681937556"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937556"><span class="hs-identifier hs-var">t</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
forall {val} {name} {ann} {uni :: * -&gt; *} {fun}.
[val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681937557"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937555"><span class="hs-identifier hs-var">argStack</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937556"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621681937557"><span class="annot"><span class="annottext">matchArgs :: [val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681937557"><span class="hs-identifier hs-var hs-var">matchArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937560"><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681937560"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937561"><span class="annot"><span class="annottext">[val]
</span><a href="#local-6989586621681937561"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681937562"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681937562"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681937564"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681937564"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681937565"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937565"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937566"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937566"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">[val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681937557"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[val]
</span><a href="#local-6989586621681937561"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UVarDecl name ann -&gt; val -&gt; Def (UVarDecl name ann) val
forall var val. var -&gt; val -&gt; Def var val
</span><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; name -&gt; UVarDecl name ann
forall name ann. ann -&gt; name -&gt; UVarDecl name ann
</span><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-var">UVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681937564"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937565"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681937560"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Def (UVarDecl name ann) val
-&gt; [Def (UVarDecl name ann) val] -&gt; [Def (UVarDecl name ann) val]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681937562"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937566"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><a href="#local-6989586621681937557"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681937569"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681937569"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681937570"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937570"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681937569"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([Def (UVarDecl name ann) val], Term name uni fun ann)
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val] -&gt; [Def (UVarDecl name ann) val]
forall a. [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681937569"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937570"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="#local-6989586621681937557"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[val]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">-- | The inverse of 'extractApps'.</span></span><span>
</span><span id="line-238"></span><span id="local-6989586621681936944"><span id="local-6989586621681936945"><span id="local-6989586621681936946"><span id="local-6989586621681936947"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-type">restoreApps</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936944"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936945"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936946"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936947"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936944"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936945"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936946"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936947"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936944"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936945"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936946"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936947"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-242"></span><span id="restoreApps"><span class="annot"><span class="annottext">restoreApps :: forall name (uni :: * -&gt; *) fun a.
[UTermDef name uni fun a]
-&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-var hs-var">restoreApps</span></a></span></span><span> </span><span id="local-6989586621681937574"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937574"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span id="local-6989586621681937575"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937575"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun a]
-&gt; Term name uni fun a
-&gt; [UTermDef name uni fun a]
-&gt; Term name uni fun a
forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681937576"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937575"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UTermDef name uni fun a] -&gt; [UTermDef name uni fun a]
forall a. [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937574"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621681937576"><span class="annot"><span class="annottext">makeLams :: [Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681937576"><span class="hs-identifier hs-var hs-var">makeLams</span></a></span></span><span> </span><span id="local-6989586621681937577"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937577"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681937578"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937578"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-type">UVarDecl</span></a></span><span> </span><span id="local-6989586621681937579"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681937579"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681937580"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937580"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681937581"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937581"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937582"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) (Term name uni fun ann)]
</span><a href="#local-6989586621681937582"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681937576"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937581"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
-&gt; [Term name uni fun ann] -&gt; [Term name uni fun ann]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937577"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; name -&gt; Term name uni fun ann -&gt; Term name uni fun ann
forall name (uni :: * -&gt; *) fun ann.
ann -&gt; name -&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681937579"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937580"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937578"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) (Term name uni fun ann)]
</span><a href="#local-6989586621681937582"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="#local-6989586621681937576"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span id="local-6989586621681937583"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937583"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681937584"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937584"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681937585"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937583"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937584"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-comment">-- This isn't the best annotation, but it will do</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621681937585"><span class="annot"><span class="annottext">makeApps :: [Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681937585"><span class="hs-identifier hs-var hs-var">makeApps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937586"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937586"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937587"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937587"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681937588"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937588"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681937585"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681937587"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
forall name (uni :: * -&gt; *) fun ann.
ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun ann -&gt; ann
forall name (uni :: * -&gt; *) fun ann. Term name uni fun ann -&gt; ann
</span><a href="UntypedPlutusCore.Core.Type.html#termAnn"><span class="hs-identifier hs-var">termAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937588"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937588"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937586"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><a href="#local-6989586621681937585"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681937589"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937589"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937589"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><span class="hs-comment">-- | Run the inliner on a `UntypedPlutusCore.Core.Type.Term`.</span></span><span>
</span><span id="line-254"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-type">processTerm</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681936899"><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681936900"><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681936901"><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681936903"><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-256"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span id="processTerm"><span class="annot"><span class="annottext">processTerm :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var hs-var">processTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681937638"><span class="hs-identifier hs-var">handleTerm</span></a></span><span>
</span><span id="line-260"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><a href="#local-6989586621681937638"><span class="hs-identifier hs-type">handleTerm</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>  </span><span id="local-6989586621681937638"><span class="annot"><span class="annottext">handleTerm :: Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681937638"><span class="hs-identifier hs-var hs-var">handleTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621681937639"><span class="annot"><span class="annottext">v :: Term name uni fun a
</span><a href="#local-6989586621681937639"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937641"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937641"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; Maybe (Term name uni fun a) -&gt; Term name uni fun a
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937639"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term name uni fun a) -&gt; Term name uni fun a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (Term name uni fun a))
-&gt; InlineM name uni fun a (Term name uni fun a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">name
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681937643"><span class="hs-identifier hs-var">substName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937641"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-comment">-- See Note [Differences from PIR inliner] 3</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; Maybe ([UTermDef name uni fun a], Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
Term name uni fun a
-&gt; Maybe ([UTermDef name uni fun a], Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-var">extractApps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937644"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937644"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937645"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937645"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>      </span><span id="local-6989586621681937646"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937646"><span class="hs-identifier hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UTermDef name uni fun a
 -&gt; ReaderT
      (InlineInfo name fun a)
      (StateT (S name uni fun a) (QuoteT Identity))
      (Maybe (UTermDef name uni fun a)))
-&gt; [UTermDef name uni fun a]
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     [UTermDef name uni fun a]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Witherable t, Applicative f) =&gt;
(a -&gt; f (Maybe b)) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f (Maybe b)) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">wither</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; UTermDef name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (UTermDef name uni fun a))
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; UTermDef name uni fun a
-&gt; InlineM name uni fun a (Maybe (UTermDef name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-var">processSingleBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937645"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937644"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-269"></span><span>      </span><span id="local-6989586621681937648"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937648"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937645"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term name uni fun a
 -&gt; InlineM name uni fun a (Term name uni fun a))
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Term name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
-&gt; Term name uni fun a -&gt; Term name uni fun a
forall name (uni :: * -&gt; *) fun a.
[UTermDef name uni fun a]
-&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-var">restoreApps</span></a></span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681937646"><span class="hs-identifier hs-var">bs'</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937648"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621681937649"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937649"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#inlineSaturatedApp"><span class="hs-identifier hs-var">inlineSaturatedApp</span></a></span><span> </span><span class="annot"><span class="annottext">(Term name uni fun a
 -&gt; InlineM name uni fun a (Term name uni fun a))
-&gt; InlineM name uni fun a (Term name uni fun a)
-&gt; InlineM name uni fun a (Term name uni fun a)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">LensLike
  (WrappedMonad
     (ReaderT
        (InlineInfo name fun a)
        (StateT (S name uni fun a) (QuoteT Identity))))
  (Term name uni fun a)
  (Term name uni fun a)
  (Term name uni fun a)
  (Term name uni fun a)
-&gt; Term name uni fun a
-&gt; (Term name uni fun a
    -&gt; InlineM name uni fun a (Term name uni fun a))
-&gt; InlineM name uni fun a (Term name uni fun a)
forall (m :: * -&gt; *) s t a b.
LensLike (WrappedMonad m) s t a b -&gt; s -&gt; (a -&gt; m b) -&gt; m t
</span><span class="hs-identifier hs-var">forMOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (WrappedMonad
     (ReaderT
        (InlineInfo name fun a)
        (StateT (S name uni fun a) (QuoteT Identity))))
  (Term name uni fun a)
  (Term name uni fun a)
  (Term name uni fun a)
  (Term name uni fun a)
forall name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
Applicative f =&gt;
(Term name uni fun ann -&gt; f (Term name uni fun ann))
-&gt; Term name uni fun ann -&gt; f (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937649"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-comment">-- See Note [Renaming strategy]</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="#local-6989586621681937643"><span class="hs-identifier hs-type">substName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621681937643"><span class="annot"><span class="annottext">substName :: name
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681937643"><span class="hs-identifier hs-var hs-var">substName</span></a></span></span><span> </span><span id="local-6989586621681937652"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937652"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(S name uni fun a -&gt; Maybe (InlineTerm name uni fun a))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (InlineTerm name uni fun a))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name -&gt; S name uni fun a -&gt; Maybe (InlineTerm name uni fun a)
forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; S name uni fun a -&gt; Maybe (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-var">lookupTerm</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937652"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  (Maybe (InlineTerm name uni fun a))
-&gt; (Maybe (InlineTerm name uni fun a)
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         (Maybe (Term name uni fun a)))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (Term name uni fun a))
forall a b.
ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  a
-&gt; (a
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         b)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(InlineTerm name uni fun a
 -&gt; InlineM name uni fun a (Term name uni fun a))
-&gt; Maybe (InlineTerm name uni fun a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (Term name uni fun a))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681937654"><span class="hs-identifier hs-var">renameTerm</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-comment">-- See Note [Inlining approach and 'Secrets of the GHC Inliner']</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><a href="#local-6989586621681937654"><span class="hs-identifier hs-type">renameTerm</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936899"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936900"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936901"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621681937654"><span class="annot"><span class="annottext">renameTerm :: InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681937654"><span class="hs-identifier hs-var hs-var">renameTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-comment">-- Already processed term, just rename and put it in, don't do any</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- further optimization here.</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621681937655"><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681937655"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
-&gt; InlineM name uni fun a (Term name uni fun a)
forall (m :: * -&gt; *) a.
(MonadQuote m, Rename a) =&gt;
Dupable a -&gt; m a
</span><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier hs-var">liftDupable</span></a></span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681937655"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span id="local-6989586621681937013"><span id="local-6989586621681937014"><span id="local-6989586621681937015"><span id="local-6989586621681937016"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-type">processSingleBinding</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937013"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937014"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937015"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937013"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937014"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937015"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937016"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937013"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937014"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937015"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937016"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937013"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937014"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937015"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937016"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937013"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937014"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937015"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937016"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-291"></span><span id="processSingleBinding"><span class="annot"><span class="annottext">processSingleBinding :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; UTermDef name uni fun a
-&gt; InlineM name uni fun a (Maybe (UTermDef name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-var hs-var">processSingleBinding</span></a></span></span><span> </span><span id="local-6989586621681937672"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937672"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681937673"><span class="annot"><span class="annottext">vd :: UVarDecl name a
</span><a href="#local-6989586621681937673"><span class="hs-identifier hs-var">vd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-type">UVarDecl</span></a></span><span> </span><span id="local-6989586621681937674"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937674"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681937675"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937675"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681937676"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937676"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; a
-&gt; name
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; a
-&gt; name
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-var">maybeAddSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937672"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937674"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937676"><span class="hs-identifier hs-var">rhs0</span></a></span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a (Maybe (Term name uni fun a))
-&gt; (Maybe (Term name uni fun a)
    -&gt; InlineM
         name
         uni
         fun
         a
         (Maybe (Def (UVarDecl name a) (Term name uni fun a))))
-&gt; InlineM
     name
     uni
     fun
     a
     (Maybe (Def (UVarDecl name a) (Term name uni fun a)))
forall a b.
ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  a
-&gt; (a
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         b)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681937678"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937678"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937679"><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937679"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937680"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937680"><span class="hs-identifier hs-var">rhsBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; ([name], Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
Term name uni fun a -&gt; ([name], Term name uni fun a)
</span><a href="UntypedPlutusCore.Core.html#splitParams"><span class="hs-identifier hs-var">UPLC.splitParams</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937678"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><span class="annottext">(S name uni fun a -&gt; S name uni fun a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#modify%27"><span class="hs-identifier hs-var">modify'</span></a></span><span> </span><span class="annot"><span class="annottext">((S name uni fun a -&gt; S name uni fun a)
 -&gt; ReaderT
      (InlineInfo name fun a)
      (StateT (S name uni fun a) (QuoteT Identity))
      ())
-&gt; (VarInfo name uni fun a -&gt; S name uni fun a -&gt; S name uni fun a)
-&gt; VarInfo name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">name
-&gt; VarInfo name uni fun a -&gt; S name uni fun a -&gt; S name uni fun a
forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; VarInfo name uni fun a -&gt; S name uni fun a -&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendVarInfo"><span class="hs-identifier hs-var">extendVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(VarInfo name uni fun a
 -&gt; ReaderT
      (InlineInfo name fun a)
      (StateT (S name uni fun a) (QuoteT Identity))
      ())
-&gt; VarInfo name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-297"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_varBinders :: [name]
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varBinders"><span class="hs-identifier hs-var">_varBinders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937679"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-298"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_varRhs :: Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varRhs"><span class="hs-identifier hs-var">_varRhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937678"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_varRhsBody :: InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_varRhsBody"><span class="hs-identifier hs-var">_varRhsBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
forall name (uni :: * -&gt; *) fun a.
Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Dupable (Term name uni fun a)
forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937680"><span class="hs-identifier hs-var">rhsBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Def (UVarDecl name a) (Term name uni fun a))
-&gt; InlineM
     name
     uni
     fun
     a
     (Maybe (Def (UVarDecl name a) (Term name uni fun a)))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Def (UVarDecl name a) (Term name uni fun a))
 -&gt; InlineM
      name
      uni
      fun
      a
      (Maybe (Def (UVarDecl name a) (Term name uni fun a))))
-&gt; (Def (UVarDecl name a) (Term name uni fun a)
    -&gt; Maybe (Def (UVarDecl name a) (Term name uni fun a)))
-&gt; Def (UVarDecl name a) (Term name uni fun a)
-&gt; InlineM
     name
     uni
     fun
     a
     (Maybe (Def (UVarDecl name a) (Term name uni fun a)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Def (UVarDecl name a) (Term name uni fun a)
-&gt; Maybe (Def (UVarDecl name a) (Term name uni fun a))
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Def (UVarDecl name a) (Term name uni fun a)
 -&gt; InlineM
      name
      uni
      fun
      a
      (Maybe (Def (UVarDecl name a) (Term name uni fun a))))
-&gt; Def (UVarDecl name a) (Term name uni fun a)
-&gt; InlineM
     name
     uni
     fun
     a
     (Maybe (Def (UVarDecl name a) (Term name uni fun a)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UVarDecl name a
-&gt; Term name uni fun a
-&gt; Def (UVarDecl name a) (Term name uni fun a)
forall var val. var -&gt; val -&gt; Def var val
</span><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">UVarDecl name a
</span><a href="#local-6989586621681937673"><span class="hs-identifier hs-var">vd</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937678"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Def (UVarDecl name a) (Term name uni fun a))
-&gt; InlineM
     name
     uni
     fun
     a
     (Maybe (Def (UVarDecl name a) (Term name uni fun a)))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Def (UVarDecl name a) (Term name uni fun a))
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><span class="hs-comment">{-| Check against the heuristics we have for inlining and either inline
the term binding or not. The arguments to this function are the fields of the
'TermBinding' being processed.
Nothing means that we are inlining the term:
  * we have extended the substitution, and
  * we are removing the binding (hence we return Nothing).
-}</span></span><span>
</span><span id="line-311"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-type">maybeAddSubst</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937049"><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937050"><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937051"><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937052"><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-313"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span id="maybeAddSubst"><span class="annot"><span class="annottext">maybeAddSubst :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; a
-&gt; name
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-var hs-var">maybeAddSubst</span></a></span></span><span> </span><span id="local-6989586621681937701"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937701"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621681937702"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937702"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681937703"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937703"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937704"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937704"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621681937705"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937705"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937704"><span class="hs-identifier hs-var">rhs0</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-comment">-- Check whether we've been told specifically to inline this</span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621681937706"><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681937706"><span class="hs-identifier hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (InlineHints name a) (InlineInfo name fun a) (InlineHints name a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (InlineHints name a)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (InlineHints name a) (InlineInfo name fun a) (InlineHints name a)
forall name fun a name a (f :: * -&gt; *).
Functor f =&gt;
(InlineHints name a -&gt; f (InlineHints name a))
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiHints"><span class="hs-identifier hs-var">iiHints</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InlineHints name a -&gt; a -&gt; name -&gt; Inline
forall name a. InlineHints name a -&gt; a -&gt; name -&gt; Inline
</span><a href="PlutusCore.Annotation.html#shouldInline"><span class="hs-identifier hs-var">shouldInline</span></a></span><span> </span><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681937706"><span class="hs-identifier hs-var">hints</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937702"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937703"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">Inline
</span><a href="PlutusCore.Annotation.html#AlwaysInline"><span class="hs-identifier hs-var">AlwaysInline</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-comment">-- if we've been told specifically, then do it right away</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681937708"><span class="hs-identifier hs-var">extendAndDrop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
forall name (uni :: * -&gt; *) fun a.
Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a)
-&gt; Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Dupable (Term name uni fun a)
forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937705"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621681937709"><span class="annot"><span class="annottext">Inline
</span><a href="#local-6989586621681937709"><span class="hs-identifier hs-var">hint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681937710"><span class="annot"><span class="annottext">safeToInline :: Bool
</span><a href="#local-6989586621681937710"><span class="hs-identifier hs-var hs-var">safeToInline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Inline
</span><a href="#local-6989586621681937709"><span class="hs-identifier hs-var">hint</span></a></span><span> </span><span class="annot"><span class="annottext">Inline -&gt; Inline -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Inline
</span><a href="PlutusCore.Annotation.html#SafeToInline"><span class="hs-identifier hs-var">SafeToInline</span></a></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  Bool
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">ifM</span></span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; name
-&gt; Term name uni fun a
-&gt; Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     Bool
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Bool
-&gt; name
-&gt; Term name uni fun a
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#shouldUnconditionallyInline"><span class="hs-identifier hs-var">shouldUnconditionallyInline</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937710"><span class="hs-identifier hs-var">safeToInline</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937703"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937705"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937701"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681937708"><span class="hs-identifier hs-var">extendAndDrop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
forall name (uni :: * -&gt; *) fun a.
Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a)
-&gt; Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Dupable (Term name uni fun a)
forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937705"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term name uni fun a)
 -&gt; InlineM name uni fun a (Maybe (Term name uni fun a)))
-&gt; Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Maybe (Term name uni fun a)
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937705"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><a href="#local-6989586621681937708"><span class="hs-identifier hs-type">extendAndDrop</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937077"><span class="annot"><a href="#local-6989586621681937077"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-337"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937049"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937050"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937051"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937052"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937077"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621681937708"><span class="annot"><span class="annottext">extendAndDrop :: forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681937708"><span class="hs-identifier hs-var hs-var">extendAndDrop</span></a></span></span><span> </span><span id="local-6989586621681937717"><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681937717"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(S name uni fun a -&gt; S name uni fun a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#modify%27"><span class="hs-identifier hs-var">modify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name
-&gt; InlineTerm name uni fun a
-&gt; S name uni fun a
-&gt; S name uni fun a
forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; InlineTerm name uni fun a
-&gt; S name uni fun a
-&gt; S name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-var">extendTerm</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937703"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681937717"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  ()
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe b)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe b)
forall a b.
ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe b)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span id="local-6989586621681937081"><span id="local-6989586621681937082"><span id="local-6989586621681937083"><span id="local-6989586621681937084"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#shouldUnconditionallyInline"><span class="hs-identifier hs-type">shouldUnconditionallyInline</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937081"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937082"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937083"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-comment">{- ^ Whether we know that the binding is safe to inline.
  If so, bypass the purity check.
  -}</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937081"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937081"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937082"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937083"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937084"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937081"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937082"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937083"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937084"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937081"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937082"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937083"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937084"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-351"></span><span id="shouldUnconditionallyInline"><span class="annot"><span class="annottext">shouldUnconditionallyInline :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Bool
-&gt; name
-&gt; Term name uni fun a
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#shouldUnconditionallyInline"><span class="hs-identifier hs-var hs-var">shouldUnconditionallyInline</span></a></span></span><span> </span><span id="local-6989586621681937739"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937739"><span class="hs-keyword hs-var">safe</span></a></span></span><span> </span><span id="local-6989586621681937740"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937740"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937741"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937741"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621681937742"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937742"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621681937743"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937743"><span class="hs-identifier hs-var">isTermPure</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
forall (uni :: * -&gt; *) fun name a.
ToBuiltinMeaning uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#checkPurity"><span class="hs-identifier hs-var">checkPurity</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937741"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span id="local-6989586621681937745"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937745"><span class="hs-identifier hs-var">inlineConstants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Bool (InlineInfo name fun a) Bool
-&gt; InlineM name uni fun a Bool
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool (InlineInfo name fun a) Bool
forall name fun a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool)
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiInlineConstants"><span class="hs-identifier hs-var">iiInlineConstants</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937746"><span class="hs-identifier hs-var">preUnconditional</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937743"><span class="hs-identifier hs-var">isTermPure</span></a></span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a Bool
-&gt; InlineM name uni fun a Bool -&gt; InlineM name uni fun a Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><span class="hs-operator hs-var">||^</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937747"><span class="hs-identifier hs-var">postUnconditional</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937745"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937743"><span class="hs-identifier hs-var">isTermPure</span></a></span><span>
</span><span id="line-355"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- similar to the paper, preUnconditional inlining checks that the binder</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-comment">-- is 'OnceSafe'.  I.e., it's used at most once AND it neither duplicate code</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- or work. While we don't check for lambda etc like in the paper,</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- 'effectSafe' ensures that it isn't doing any substantial work.</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- We actually also inline 'Dead' binders (i.e., remove dead code) here.</span><span>
</span><span id="line-361"></span><span>  </span><span id="local-6989586621681937746"><span class="annot"><span class="annottext">preUnconditional :: Bool -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937746"><span class="hs-identifier hs-var hs-var">preUnconditional</span></a></span></span><span> </span><span id="local-6989586621681937748"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937748"><span class="hs-identifier hs-var">isTermPure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">name -&gt; InlineM name uni fun a Bool
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
name -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#nameUsedAtMostOnce"><span class="hs-identifier hs-var">nameUsedAtMostOnce</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937740"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a Bool
-&gt; InlineM name uni fun a Bool -&gt; InlineM name uni fun a Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><span class="hs-operator hs-var">&amp;&amp;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937739"><span class="hs-keyword hs-var">safe</span></a></span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a Bool
-&gt; InlineM name uni fun a Bool -&gt; InlineM name uni fun a Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><span class="hs-operator hs-var">||^</span></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; name -&gt; Bool -&gt; InlineM name uni fun a Bool
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; name -&gt; Bool -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#effectSafe"><span class="hs-identifier hs-var">effectSafe</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937742"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937740"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937748"><span class="hs-identifier hs-var">isTermPure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-comment">-- See Note [Inlining approach and 'Secrets of the GHC Inliner'] and</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- [Inlining and purity]. This is the case where we don't know that the number</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-comment">-- of occurrences is exactly one, so there's no point checking if the term is</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-comment">-- immediately evaluated.</span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621681937747"><span class="annot"><span class="annottext">postUnconditional :: Bool -&gt; Bool -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937747"><span class="hs-identifier hs-var hs-var">postUnconditional</span></a></span></span><span> </span><span id="local-6989586621681937751"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937751"><span class="hs-identifier hs-var">inlineConstants</span></a></span></span><span> </span><span id="local-6989586621681937752"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937752"><span class="hs-identifier hs-var">isTermPure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937739"><span class="hs-keyword hs-var">safe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937752"><span class="hs-identifier hs-var">isTermPure</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a Bool
-&gt; InlineM name uni fun a Bool -&gt; InlineM name uni fun a Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><span class="hs-operator hs-var">&amp;&amp;^</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#acceptable"><span class="hs-identifier hs-var">acceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937751"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937741"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="annot"><span class="hs-comment">-- | Check if term is pure. See Note [Inlining and purity]</span></span><span>
</span><span id="line-371"></span><span id="local-6989586621681937092"><span id="local-6989586621681937093"><span id="local-6989586621681937094"><span id="local-6989586621681937095"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#checkPurity"><span class="hs-identifier hs-type">checkPurity</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937092"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937093"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937094"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937092"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937093"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937095"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937094"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937092"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937093"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937095"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-375"></span><span id="checkPurity"><span class="annot"><span class="annottext">checkPurity :: forall (uni :: * -&gt; *) fun name a.
ToBuiltinMeaning uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#checkPurity"><span class="hs-identifier hs-var hs-var">checkPurity</span></a></span></span><span> </span><span id="local-6989586621681937767"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937767"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621681937768"><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937768"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (BuiltinSemanticsVariant fun)
  (InlineInfo name fun a)
  (BuiltinSemanticsVariant fun)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (BuiltinSemanticsVariant fun)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (BuiltinSemanticsVariant fun)
  (InlineInfo name fun a)
  (BuiltinSemanticsVariant fun)
forall name fun a fun (f :: * -&gt; *).
Functor f =&gt;
(BuiltinSemanticsVariant fun -&gt; f (BuiltinSemanticsVariant fun))
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiBuiltinSemanticsVariant"><span class="hs-identifier hs-var">iiBuiltinSemanticsVariant</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; InlineM name uni fun a Bool)
-&gt; Bool -&gt; InlineM name uni fun a Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun -&gt; Term name uni fun a -&gt; Bool
forall (uni :: * -&gt; *) fun name a.
ToBuiltinMeaning uni fun =&gt;
BuiltinSemanticsVariant fun -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Purity.html#isPure"><span class="hs-identifier hs-var">isPure</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937768"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937767"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#nameUsedAtMostOnce"><span class="hs-identifier hs-type">nameUsedAtMostOnce</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937097"><span class="annot"><a href="#local-6989586621681937097"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937098"><span class="annot"><a href="#local-6989586621681937098"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937099"><span class="annot"><a href="#local-6989586621681937099"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937100"><span class="annot"><a href="#local-6989586621681937100"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-381"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937097"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937098"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937099"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937097"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937097"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937098"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937099"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-384"></span><span id="nameUsedAtMostOnce"><span class="annot"><span class="annottext">nameUsedAtMostOnce :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
name -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#nameUsedAtMostOnce"><span class="hs-identifier hs-var hs-var">nameUsedAtMostOnce</span></a></span></span><span> </span><span id="local-6989586621681937784"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937784"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621681937785"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681937785"><span class="hs-identifier hs-var">usgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Usages (InlineInfo name fun a) Usages
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     Usages
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Usages (InlineInfo name fun a) Usages
forall name fun a (f :: * -&gt; *).
Functor f =&gt;
(Usages -&gt; f Usages)
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiUsages"><span class="hs-identifier hs-var">iiUsages</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- 'inlining' terms used 0 times is a cheap way to remove dead code</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- while we're here</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; InlineM name uni fun a Bool)
-&gt; Bool -&gt; InlineM name uni fun a Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; Usages -&gt; Int
forall n unique. HasUnique n unique =&gt; n -&gt; Usages -&gt; Int
</span><a href="UntypedPlutusCore.Analysis.Usages.html#getUsageCount"><span class="hs-identifier hs-var">Usages.getUsageCount</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937784"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681937785"><span class="hs-identifier hs-var">usgs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#isFirstVarBeforeEffects"><span class="hs-identifier hs-type">isFirstVarBeforeEffects</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937124"><span class="annot"><a href="#local-6989586621681937124"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937125"><span class="annot"><a href="#local-6989586621681937125"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937126"><span class="annot"><a href="#local-6989586621681937126"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937127"><span class="annot"><a href="#local-6989586621681937127"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-392"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937124"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937125"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937126"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937124"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937124"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937125"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937126"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937127"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937124"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937125"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937126"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937127"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-396"></span><span id="isFirstVarBeforeEffects"><span class="annot"><span class="annottext">isFirstVarBeforeEffects :: forall name (uni :: * -&gt; *) fun ann.
InliningConstraints name uni fun =&gt;
name -&gt; Term name uni fun ann -&gt; InlineM name uni fun ann Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#isFirstVarBeforeEffects"><span class="hs-identifier hs-var hs-var">isFirstVarBeforeEffects</span></a></span></span><span> </span><span id="local-6989586621681937804"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937804"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937805"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937805"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621681937806"><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937806"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (BuiltinSemanticsVariant fun)
  (InlineInfo name fun ann)
  (BuiltinSemanticsVariant fun)
-&gt; ReaderT
     (InlineInfo name fun ann)
     (StateT (S name uni fun ann) (QuoteT Identity))
     (BuiltinSemanticsVariant fun)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (BuiltinSemanticsVariant fun)
  (InlineInfo name fun ann)
  (BuiltinSemanticsVariant fun)
forall name fun a fun (f :: * -&gt; *).
Functor f =&gt;
(BuiltinSemanticsVariant fun -&gt; f (BuiltinSemanticsVariant fun))
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiBuiltinSemanticsVariant"><span class="hs-identifier hs-var">iiBuiltinSemanticsVariant</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-comment">-- This can in the worst case traverse a lot of the term, which could lead to</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-comment">-- us doing ~quadratic work as we process the program. However in practice</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-comment">-- most terms have a relatively short evaluation order before we hit Unknown,</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-comment">-- so it's not too bad.</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun ann Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun ann)
     (StateT (S name uni fun ann) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; InlineM name uni fun ann Bool)
-&gt; Bool -&gt; InlineM name uni fun ann Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann] -&gt; Bool
</span><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalOrder name uni fun ann -&gt; [EvalTerm name uni fun ann]
forall name (uni :: * -&gt; *) fun a.
EvalOrder name uni fun a -&gt; [EvalTerm name uni fun a]
</span><a href="UntypedPlutusCore.Purity.html#unEvalOrder"><span class="hs-identifier hs-var">unEvalOrder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
-&gt; Term name uni fun ann -&gt; EvalOrder name uni fun ann
forall name (uni :: * -&gt; *) fun a.
ToBuiltinMeaning uni fun =&gt;
BuiltinSemanticsVariant fun
-&gt; Term name uni fun a -&gt; EvalOrder name uni fun a
</span><a href="UntypedPlutusCore.Purity.html#termEvaluationOrder"><span class="hs-identifier hs-var">termEvaluationOrder</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinSemanticsVariant fun
</span><a href="#local-6989586621681937806"><span class="hs-identifier hs-var">builtinSemanticsVariant</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681937805"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-comment">-- Found the variable we're looking for!</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621681937807"><span class="annot"><span class="annottext">go :: [EvalTerm name uni fun ann] -&gt; Bool
</span><a href="#local-6989586621681937807"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#EvalTerm"><span class="hs-identifier hs-type">EvalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Purity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WorkFreedom
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937808"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937808"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937804"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937808"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-comment">-- Found a pure term, ignore it and continue</span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#EvalTerm"><span class="hs-identifier hs-type">EvalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="UntypedPlutusCore.Purity.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span><span> </span><span class="annot"><span class="annottext">WorkFreedom
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937809"><span class="annot"><span class="annottext">[EvalTerm name uni fun ann]
</span><a href="#local-6989586621681937809"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann] -&gt; Bool
</span><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann]
</span><a href="#local-6989586621681937809"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-comment">-- Found a possibly impure term, our variable is definitely not first</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Purity.html#EvalTerm"><span class="hs-identifier hs-type">EvalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="UntypedPlutusCore.Purity.html#MaybeImpure"><span class="hs-identifier hs-var">MaybeImpure</span></a></span><span> </span><span class="annot"><span class="annottext">WorkFreedom
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-comment">-- Don't know, be conservative</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalTerm name uni fun ann
</span><a href="UntypedPlutusCore.Purity.html#Unknown"><span class="hs-identifier hs-var">Unknown</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalTerm name uni fun ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="#local-6989586621681937807"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#effectSafe"><span class="hs-identifier hs-type">effectSafe</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937101"><span class="annot"><a href="#local-6989586621681937101"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937102"><span class="annot"><a href="#local-6989586621681937102"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937103"><span class="annot"><a href="#local-6989586621681937103"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937104"><span class="annot"><a href="#local-6989586621681937104"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-416"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937101"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937102"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937103"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937101"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937102"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937103"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937104"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681937101"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ is it pure?</span></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937101"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937102"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937103"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937104"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-422"></span><span id="effectSafe"><span class="annot"><span class="annottext">effectSafe :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; name -&gt; Bool -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#effectSafe"><span class="hs-identifier hs-var hs-var">effectSafe</span></a></span></span><span> </span><span id="local-6989586621681937820"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937820"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621681937821"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937821"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681937822"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937822"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621681937823"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937823"><span class="hs-identifier hs-var">immediatelyEvaluated</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">name -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
forall name (uni :: * -&gt; *) fun ann.
InliningConstraints name uni fun =&gt;
name -&gt; Term name uni fun ann -&gt; InlineM name uni fun ann Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#isFirstVarBeforeEffects"><span class="hs-identifier hs-var">isFirstVarBeforeEffects</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937821"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937820"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; InlineM name uni fun a Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; InlineM name uni fun a Bool)
-&gt; Bool -&gt; InlineM name uni fun a Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937822"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937823"><span class="hs-identifier hs-var">immediatelyEvaluated</span></a></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="annot"><span class="hs-comment">{-| Should we inline? Should only inline things that won't duplicate work
or code.  See Note [Inlining approach and 'Secrets of the GHC Inliner']
-}</span></span><span>
</span><span id="line-429"></span><span id="local-6989586621681937105"><span id="local-6989586621681937106"><span id="local-6989586621681937107"><span id="local-6989586621681937108"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#acceptable"><span class="hs-identifier hs-type">acceptable</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ inline constants</span></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937105"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937106"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937107"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937108"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937105"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937106"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937107"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-434"></span><span id="acceptable"><span class="annot"><span class="annottext">acceptable :: forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#acceptable"><span class="hs-identifier hs-var hs-var">acceptable</span></a></span></span><span> </span><span id="local-6989586621681937830"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937830"><span class="hs-identifier hs-var">inlineConstants</span></a></span></span><span> </span><span id="local-6989586621681937831"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937831"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-comment">-- See Note [Inlining criteria]</span><span>
</span><span id="line-436"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     Bool
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool
 -&gt; ReaderT
      (InlineInfo name fun a)
      (StateT (S name uni fun a) (QuoteT Identity))
      Bool)
-&gt; Bool
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var">costIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937831"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937830"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937831"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><span class="hs-comment">{-| Is the cost increase (in terms of evaluation work) of inlining a variable
whose RHS is the given term acceptable?
-}</span></span><span>
</span><span id="line-441"></span><span id="local-6989586621681937152"><span id="local-6989586621681937153"><span id="local-6989586621681937154"><span id="local-6989586621681937155"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-type">costIsAcceptable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937152"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937153"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937154"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937155"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-442"></span><span id="costIsAcceptable"><span class="annot"><span class="annottext">costIsAcceptable :: forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var hs-var">costIsAcceptable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- This will mean that we create closures at each use site instead of</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">-- once, but that's a very low cost which we're okay rounding to 0.</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-comment">-- Inlining constructors of size 1 or 0 seems okay, but does result in doing</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-comment">-- the work for the elements at each use site.</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937839"><span class="annot"><span class="annottext">[Term name uni fun a]
</span><a href="#local-6989586621681937839"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun a]
</span><a href="#local-6989586621681937839"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621681937840"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937840"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var">costIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937840"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">[Term name uni fun a]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-comment">-- Inlining a case means redoing the match at each use site</span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><span class="hs-comment">{-| Is the size increase (in the AST) of inlining a variable whose RHS is
the given term acceptable?
-}</span></span><span>
</span><span id="line-466"></span><span id="local-6989586621681937156"><span id="local-6989586621681937157"><span id="local-6989586621681937158"><span id="local-6989586621681937159"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-type">sizeIsAcceptable</span></a></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ inline constants</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937156"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937157"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937158"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937159"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-471"></span><span id="sizeIsAcceptable"><span class="annot"><span class="annottext">sizeIsAcceptable :: forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var hs-var">sizeIsAcceptable</span></a></span></span><span> </span><span id="local-6989586621681937844"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937844"><span class="hs-identifier hs-var">inlineConstants</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-comment">-- See Note [Differences from PIR inliner] 4</span><span>
</span><span id="line-476"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-comment">-- Inlining constructors of size 1 or 0 seems okay</span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937845"><span class="annot"><span class="annottext">[Term name uni fun a]
</span><a href="#local-6989586621681937845"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun a]
</span><a href="#local-6989586621681937845"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621681937846"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937846"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937844"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937846"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">[Term name uni fun a]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-comment">-- Cases are pretty big, due to the case branches</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-comment">-- Inlining constants is deemed acceptable if the 'inlineConstants'</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-comment">-- flag is turned on, see Note [Inlining constants].</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937844"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-488"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937847"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937847"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937844"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937847"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681937848"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937848"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a.
Bool -&gt; Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937844"><span class="hs-identifier hs-var">inlineConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937848"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="annot"><span class="hs-comment">-- | Fully apply and beta reduce.</span></span><span>
</span><span id="line-492"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#fullyApplyAndBetaReduce"><span class="hs-identifier hs-type">fullyApplyAndBetaReduce</span></a></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937168"><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937169"><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937170"><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937171"><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-494"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="fullyApplyAndBetaReduce"><span class="annot"><span class="annottext">fullyApplyAndBetaReduce :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
VarInfo name uni fun a
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#fullyApplyAndBetaReduce"><span class="hs-identifier hs-var hs-var">fullyApplyAndBetaReduce</span></a></span></span><span> </span><span id="local-6989586621681937882"><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937882"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681937883"><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937883"><span class="hs-identifier hs-var">args0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>  </span><span id="local-6989586621681937884"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937884"><span class="hs-identifier hs-var">rhsBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall (m :: * -&gt; *) a.
(MonadQuote m, Rename a) =&gt;
Dupable a -&gt; m a
</span><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier hs-var">liftDupable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621681937885"><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681937885"><span class="hs-identifier hs-var">rhsBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937882"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
-&gt; Getting
     (InlineTerm name uni fun a)
     (VarInfo name uni fun a)
     (InlineTerm name uni fun a)
-&gt; InlineTerm name uni fun a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (InlineTerm name uni fun a)
  (VarInfo name uni fun a)
  (InlineTerm name uni fun a)
forall name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
Functor f =&gt;
(InlineTerm name uni fun ann -&gt; f (InlineTerm name uni fun ann))
-&gt; VarInfo name uni fun ann -&gt; f (VarInfo name uni fun ann)
</span><a href="UntypedPlutusCore.Transform.Inline.html#varRhsBody"><span class="hs-identifier hs-var">varRhsBody</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681937885"><span class="hs-identifier hs-var">rhsBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681937886"><span class="hs-identifier hs-type">go</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>      </span><span id="local-6989586621681937886"><span class="annot"><span class="annottext">go :: Term name uni fun a
-&gt; [name]
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681937886"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681937887"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937887"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681937888"><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937888"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681937889"><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937889"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937888"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937889"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term name uni fun a)
 -&gt; InlineM name uni fun a (Maybe (Term name uni fun a)))
-&gt; (Term name uni fun a -&gt; Maybe (Term name uni fun a))
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Maybe (Term name uni fun a)
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Term name uni fun a
 -&gt; InlineM name uni fun a (Maybe (Term name uni fun a)))
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; [(a, Term name uni fun a)] -&gt; Term name uni fun a
forall (term :: * -&gt; *) tyname name (uni :: * -&gt; *) fun ann.
TermLike term tyname name uni fun =&gt;
term ann -&gt; [(ann, term ann)] -&gt; term ann
</span><a href="PlutusCore.MkPlc.html#mkIterApp"><span class="hs-identifier hs-var">mkIterApp</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937887"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937889"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-507"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681937890"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937890"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937891"><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937891"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681937892"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937892"><span class="hs-identifier hs-var">_ann</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937893"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937893"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681937894"><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937894"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>          </span><span id="local-6989586621681937895"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937895"><span class="hs-keyword hs-var">safe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">name -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937896"><span class="hs-identifier hs-var">safeToBetaReduce</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937890"><span class="hs-identifier hs-var">param</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937893"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-509"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937895"><span class="hs-keyword hs-var">safe</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-511"></span><span>              </span><span id="local-6989586621681937897"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937897"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-512"></span><span>                </span><span class="annot"><span class="annottext">(name -&gt; InlineM name uni fun a (Maybe (Term name uni fun a)))
-&gt; Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun ann.
Monad m =&gt;
(name -&gt; m (Maybe (Term name uni fun ann)))
-&gt; Term name uni fun ann -&gt; m (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Subst.html#termSubstNamesM"><span class="hs-identifier hs-var">termSubstNamesM</span></a></span><span>
</span><span id="line-513"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681937898"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937898"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937898"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937890"><span class="hs-identifier hs-var">param</span></a></span><span>
</span><span id="line-515"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Maybe (Term name uni fun a)
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Term name uni fun a -&gt; Maybe (Term name uni fun a))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
forall (m :: * -&gt; *).
MonadQuote m =&gt;
Term name uni fun a -&gt; m (Term name uni fun a)
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">PLC.rename</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937893"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-516"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-517"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>                  </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937887"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-519"></span><span>              </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; [name]
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681937886"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937897"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">[name]
</span><a href="#local-6989586621681937891"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937894"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-520"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><span class="annottext">([name], [(a, Term name uni fun a)])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
forall a. Maybe a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>      </span><span class="hs-comment">-- Is it safe to turn `(\a -&gt; body) arg` into `body [a := arg]`?</span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-comment">-- The criteria is the same as the criteria for unconditionally</span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-comment">-- inlining `a`, since inlining is the same as beta reduction.</span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><a href="#local-6989586621681937896"><span class="hs-identifier hs-type">safeToBetaReduce</span></a></span><span>
</span><span id="line-527"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-528"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937169"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937170"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937171"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-530"></span><span>      </span><span id="local-6989586621681937896"><span class="annot"><span class="annottext">safeToBetaReduce :: name -&gt; Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681937896"><span class="hs-identifier hs-var hs-var">safeToBetaReduce</span></a></span></span><span> </span><span id="local-6989586621681937900"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937900"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681937901"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937901"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; name
-&gt; Term name uni fun a
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a Bool
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Bool
-&gt; name
-&gt; Term name uni fun a
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#shouldUnconditionallyInline"><span class="hs-identifier hs-var">shouldUnconditionallyInline</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937900"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937901"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937884"><span class="hs-identifier hs-var">rhsBody</span></a></span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; [name]
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681937886"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937884"><span class="hs-identifier hs-var">rhsBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937882"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
-&gt; Getting [name] (VarInfo name uni fun a) [name] -&gt; [name]
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting [name] (VarInfo name uni fun a) [name]
forall name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
Functor f =&gt;
([name] -&gt; f [name])
-&gt; VarInfo name uni fun ann -&gt; f (VarInfo name uni fun ann)
</span><a href="UntypedPlutusCore.Transform.Inline.html#varBinders"><span class="hs-identifier hs-var">varBinders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937883"><span class="hs-identifier hs-var">args0</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><span class="hs-comment">{-| This works in the same way as
'PlutusIR.Transform.Inline.CallSiteInline.inlineSaturatedApp'.
See Note [Inlining and beta reduction of functions].
-}</span></span><span>
</span><span id="line-537"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#inlineSaturatedApp"><span class="hs-identifier hs-type">inlineSaturatedApp</span></a></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681937902"><span class="annot"><a href="#local-6989586621681937902"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681937903"><span class="annot"><a href="#local-6989586621681937903"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681937904"><span class="annot"><a href="#local-6989586621681937904"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681937905"><span class="annot"><a href="#local-6989586621681937905"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-539"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937902"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937903"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937904"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937902"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937903"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937904"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937902"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937903"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937904"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937902"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937903"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937904"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681937905"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span id="inlineSaturatedApp"><span class="annot"><span class="annottext">inlineSaturatedApp :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#inlineSaturatedApp"><span class="hs-identifier hs-var hs-var">inlineSaturatedApp</span></a></span></span><span> </span><span id="local-6989586621681937937"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681937938"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681937938"><span class="hs-identifier hs-var">_ann</span></a></span></span><span> </span><span id="local-6989586621681937939"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937939"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681937940"><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937940"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; (Term name uni fun a, [(a, Term name uni fun a)])
forall name (uni :: * -&gt; *) fun a.
Term name uni fun a
-&gt; (Term name uni fun a, [(a, Term name uni fun a)])
</span><a href="UntypedPlutusCore.Core.html#splitApplication"><span class="hs-identifier hs-var">UPLC.splitApplication</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-544"></span><span>      </span><span class="annot"><span class="annottext">(S name uni fun a -&gt; Maybe (VarInfo name uni fun a))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Maybe (VarInfo name uni fun a))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name -&gt; S name uni fun a -&gt; Maybe (VarInfo name uni fun a)
forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; S name uni fun a -&gt; Maybe (VarInfo name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681937939"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  (Maybe (VarInfo name uni fun a))
-&gt; (Maybe (VarInfo name uni fun a)
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         (Term name uni fun a))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a b.
ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  a
-&gt; (a
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         b)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">Maybe (VarInfo name uni fun a)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681937942"><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937942"><span class="hs-identifier hs-var">varInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>          </span><span class="annot"><span class="annottext">VarInfo name uni fun a
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
VarInfo name uni fun a
-&gt; [(a, Term name uni fun a)]
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#fullyApplyAndBetaReduce"><span class="hs-identifier hs-var">fullyApplyAndBetaReduce</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937942"><span class="hs-identifier hs-var">varInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Term name uni fun a)]
</span><a href="#local-6989586621681937940"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">InlineM name uni fun a (Maybe (Term name uni fun a))
-&gt; (Maybe (Term name uni fun a)
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         (Term name uni fun a))
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a b.
ReaderT
  (InlineInfo name fun a)
  (StateT (S name uni fun a) (QuoteT Identity))
  a
-&gt; (a
    -&gt; ReaderT
         (InlineInfo name fun a)
         (StateT (S name uni fun a) (QuoteT Identity))
         b)
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-548"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-549"></span><span>            </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681937943"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937943"><span class="hs-identifier hs-var">fullyApplied</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>              </span><span id="local-6989586621681937944"><span class="annot"><span class="annottext">Size
</span><a href="#local-6989586621681937944"><span class="hs-identifier hs-var">thresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Size (InlineInfo name fun a) Size
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     Size
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Size (InlineInfo name fun a) Size
forall name fun a (f :: * -&gt; *).
Functor f =&gt;
(Size -&gt; f Size)
-&gt; InlineInfo name fun a -&gt; f (InlineInfo name fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#iiInlineCallsiteGrowth"><span class="hs-identifier hs-var">iiInlineCallsiteGrowth</span></a></span><span>
</span><span id="line-551"></span><span>              </span><span class="hs-keyword">let</span><span>
</span><span id="line-552"></span><span>                </span><span class="hs-comment">-- Inline only if the size is no bigger than</span><span>
</span><span id="line-553"></span><span>                </span><span class="hs-comment">-- not inlining plus threshold.</span><span>
</span><span id="line-554"></span><span>                </span><span id="local-6989586621681937945"><span class="annot"><span class="annottext">sizeIsOk :: Bool
</span><a href="#local-6989586621681937945"><span class="hs-identifier hs-var hs-var">sizeIsOk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>                  </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Size
forall name (uni :: * -&gt; *) fun ann. Term name uni fun ann -&gt; Size
</span><a href="UntypedPlutusCore.Size.html#termSize"><span class="hs-identifier hs-var">termSize</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937943"><span class="hs-identifier hs-var">fullyApplied</span></a></span><span> </span><span class="annot"><span class="annottext">Size -&gt; Size -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Size
forall name (uni :: * -&gt; *) fun ann. Term name uni fun ann -&gt; Size
</span><a href="UntypedPlutusCore.Size.html#termSize"><span class="hs-identifier hs-var">termSize</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Size -&gt; Size -&gt; Size
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Size -&gt; Size -&gt; Size
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#max"><span class="hs-identifier hs-var">max</span></a></span><span> </span><span class="annot"><span class="annottext">Size
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Size
</span><a href="#local-6989586621681937944"><span class="hs-identifier hs-var">thresh</span></a></span><span>
</span><span id="line-556"></span><span>                </span><span id="local-6989586621681937948"><span class="annot"><span class="annottext">rhs :: Term name uni fun a
</span><a href="#local-6989586621681937948"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
</span><a href="#local-6989586621681937942"><span class="hs-identifier hs-var">varInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo name uni fun a
-&gt; Getting
     (Term name uni fun a)
     (VarInfo name uni fun a)
     (Term name uni fun a)
-&gt; Term name uni fun a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Term name uni fun a)
  (VarInfo name uni fun a)
  (Term name uni fun a)
forall name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
Functor f =&gt;
(Term name uni fun ann -&gt; f (Term name uni fun ann))
-&gt; VarInfo name uni fun ann -&gt; f (VarInfo name uni fun ann)
</span><a href="UntypedPlutusCore.Transform.Inline.html#varRhs"><span class="hs-identifier hs-var">varRhs</span></a></span><span>
</span><span id="line-557"></span><span>                </span><span class="hs-comment">-- Cost is always OK if the RHS is a LamAbs,</span><span>
</span><span id="line-558"></span><span>                </span><span class="hs-comment">-- but may not be otherwise.</span><span>
</span><span id="line-559"></span><span>                </span><span id="local-6989586621681937949"><span class="annot"><span class="annottext">costIsOk :: Bool
</span><a href="#local-6989586621681937949"><span class="hs-identifier hs-var hs-var">costIsOk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; Bool
forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var">costIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937948"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-560"></span><span>              </span><span class="hs-comment">-- The RHS is always pure if it is a LamAbs,</span><span>
</span><span id="line-561"></span><span>              </span><span class="hs-comment">-- but may not be otherwise.</span><span>
</span><span id="line-562"></span><span>              </span><span id="local-6989586621681937950"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937950"><span class="hs-identifier hs-var">rhsPure</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
forall (uni :: * -&gt; *) fun name a.
ToBuiltinMeaning uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#checkPurity"><span class="hs-identifier hs-var">checkPurity</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937948"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-563"></span><span>              </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term name uni fun a
 -&gt; ReaderT
      (InlineInfo name fun a)
      (StateT (S name uni fun a) (QuoteT Identity))
      (Term name uni fun a))
-&gt; Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-564"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937945"><span class="hs-identifier hs-var">sizeIsOk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937949"><span class="hs-identifier hs-var">costIsOk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681937950"><span class="hs-identifier hs-var">rhsPure</span></a></span><span>
</span><span id="line-565"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937943"><span class="hs-identifier hs-var">fullyApplied</span></a></span><span>
</span><span id="line-566"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     (Term name uni fun a)
forall a.
a
-&gt; ReaderT
     (InlineInfo name fun a)
     (StateT (S name uni fun a) (QuoteT Identity))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681937937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-568"></span></pre></body></html>