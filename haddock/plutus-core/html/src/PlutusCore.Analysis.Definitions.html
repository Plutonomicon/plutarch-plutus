<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="annot"><span class="hs-comment">-- | Definition analysis for Plutus Core.</span></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Analysis.Definitions</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier">UniqueInfos</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier">ScopeType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier">termDefs</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#handleType"><span class="hs-identifier">handleType</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#runTermDefs"><span class="hs-identifier">runTermDefs</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier">addDef</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier">addUsage</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.html"><span class="hs-identifier">PlutusCore.Core</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Error.html"><span class="hs-identifier">PlutusCore.Error</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forMOf_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">execStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadWriter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runWriterT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tell</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">{- Note [Unique usage errors]
The definitions analysis can find a number of problems with usage of uniques, however
clients may not always want to throw an error on all of them, hence we simply return
them all and allow the client to chose if they want to throw some of them.
-}</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="annot"><span class="hs-comment">-- | Information about a unique, a pair of a definition if we have one and a set of uses.</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span id="UniqueInfo"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-var">UniqueInfo</span></a></span></span><span> </span><span id="local-6989586621680893353"><span class="annot"><a href="#local-6989586621680893353"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893353"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893353"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">type</span><span> </span><span id="UniqueInfos"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-var">UniqueInfos</span></a></span></span><span> </span><span id="local-6989586621680893354"><span class="annot"><a href="#local-6989586621680893354"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#UniqueMap"><span class="hs-identifier hs-type">UniqueMap</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893354"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">data</span><span> </span><span id="ScopedLoc"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a></span></span><span> </span><span id="local-6989586621680893202"><span class="annot"><a href="#local-6989586621680893202"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScopedLoc"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a></span></span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893202"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680893358"><span id="local-6989586621680893363"><span class="annot"><span class="annottext">ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
(ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool) -&gt; Eq (ScopedLoc ann)
forall ann. Eq ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall ann. Eq ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
== :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
$c/= :: forall ann. Eq ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
/= :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680893372"><span id="local-6989586621680893377"><span id="local-6989586621680893381"><span id="local-6989586621680893385"><span id="local-6989586621680893388"><span id="local-6989586621680893391"><span id="local-6989586621680893394"><span class="annot"><span class="annottext">Eq (ScopedLoc ann)
Eq (ScopedLoc ann) =&gt;
(ScopedLoc ann -&gt; ScopedLoc ann -&gt; Ordering)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann)
-&gt; (ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann)
-&gt; Ord (ScopedLoc ann)
ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
ScopedLoc ann -&gt; ScopedLoc ann -&gt; Ordering
ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall ann. Ord ann =&gt; Eq (ScopedLoc ann)
forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Ordering
forall ann.
Ord ann =&gt;
ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
$ccompare :: forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Ordering
compare :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Ordering
$c&lt; :: forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
&lt; :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
$c&lt;= :: forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
&lt;= :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
$c&gt; :: forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
&gt; :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
$c&gt;= :: forall ann. Ord ann =&gt; ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
&gt;= :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; Bool
$cmax :: forall ann.
Ord ann =&gt;
ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
max :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
$cmin :: forall ann.
Ord ann =&gt;
ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
min :: ScopedLoc ann -&gt; ScopedLoc ann -&gt; ScopedLoc ann
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Tag for distinguishing between whether we are talking about the term scope</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- for variables or the type scope for variables.</span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="ScopeType"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-var">ScopeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermScope"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier hs-var">TermScope</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TypeScope"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680893401"><span id="local-6989586621680893403"><span class="annot"><span class="annottext">ScopeType -&gt; ScopeType -&gt; Bool
(ScopeType -&gt; ScopeType -&gt; Bool)
-&gt; (ScopeType -&gt; ScopeType -&gt; Bool) -&gt; Eq ScopeType
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ScopeType -&gt; ScopeType -&gt; Bool
== :: ScopeType -&gt; ScopeType -&gt; Bool
$c/= :: ScopeType -&gt; ScopeType -&gt; Bool
/= :: ScopeType -&gt; ScopeType -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680893408"><span id="local-6989586621680893410"><span id="local-6989586621680893412"><span id="local-6989586621680893415"><span id="local-6989586621680893418"><span id="local-6989586621680893421"><span id="local-6989586621680893424"><span class="annot"><span class="annottext">Eq ScopeType
Eq ScopeType =&gt;
(ScopeType -&gt; ScopeType -&gt; Ordering)
-&gt; (ScopeType -&gt; ScopeType -&gt; Bool)
-&gt; (ScopeType -&gt; ScopeType -&gt; Bool)
-&gt; (ScopeType -&gt; ScopeType -&gt; Bool)
-&gt; (ScopeType -&gt; ScopeType -&gt; Bool)
-&gt; (ScopeType -&gt; ScopeType -&gt; ScopeType)
-&gt; (ScopeType -&gt; ScopeType -&gt; ScopeType)
-&gt; Ord ScopeType
ScopeType -&gt; ScopeType -&gt; Bool
ScopeType -&gt; ScopeType -&gt; Ordering
ScopeType -&gt; ScopeType -&gt; ScopeType
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: ScopeType -&gt; ScopeType -&gt; Ordering
compare :: ScopeType -&gt; ScopeType -&gt; Ordering
$c&lt; :: ScopeType -&gt; ScopeType -&gt; Bool
&lt; :: ScopeType -&gt; ScopeType -&gt; Bool
$c&lt;= :: ScopeType -&gt; ScopeType -&gt; Bool
&lt;= :: ScopeType -&gt; ScopeType -&gt; Bool
$c&gt; :: ScopeType -&gt; ScopeType -&gt; Bool
&gt; :: ScopeType -&gt; ScopeType -&gt; Bool
$c&gt;= :: ScopeType -&gt; ScopeType -&gt; Bool
&gt;= :: ScopeType -&gt; ScopeType -&gt; Bool
$cmax :: ScopeType -&gt; ScopeType -&gt; ScopeType
max :: ScopeType -&gt; ScopeType -&gt; ScopeType
$cmin :: ScopeType -&gt; ScopeType -&gt; ScopeType
min :: ScopeType -&gt; ScopeType -&gt; ScopeType
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span id="local-6989586621680893149"><span id="local-6989586621680893150"><span id="local-6989586621680893151"><span id="local-6989586621680893154"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-type">lookupDef</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893149"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893150"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893151"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893149"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893154"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893150"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893154"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893149"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-48"></span><span id="lookupDef"><span class="annot"><span class="annottext">lookupDef :: forall ann name unique (m :: * -&gt; *).
(Ord ann, HasUnique name unique, MonadState (UniqueInfos ann) m) =&gt;
name -&gt; m (UniqueInfo ann)
</span><a href="PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-var hs-var">lookupDef</span></a></span></span><span> </span><span id="local-6989586621680893444"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893444"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-49"></span><span>    </span><span id="local-6989586621680893445"><span class="annot"><span class="annottext">Maybe (UniqueInfo ann)
</span><a href="#local-6989586621680893445"><span class="hs-identifier hs-var">previousDef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UniqueInfos ann -&gt; Maybe (UniqueInfo ann))
-&gt; m (Maybe (UniqueInfo ann))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((UniqueInfos ann -&gt; Maybe (UniqueInfo ann))
 -&gt; m (Maybe (UniqueInfo ann)))
-&gt; (UniqueInfos ann -&gt; Maybe (UniqueInfo ann))
-&gt; m (Maybe (UniqueInfo ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; UniqueInfos ann -&gt; Maybe (UniqueInfo ann)
forall name unique1 unique2 a.
(HasUnique name unique1, Coercible unique2 Unique) =&gt;
name -&gt; UniqueMap unique2 a -&gt; Maybe a
</span><a href="PlutusCore.Name.html#lookupNameIndex"><span class="hs-identifier hs-var">lookupNameIndex</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893444"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (UniqueInfo ann)
</span><a href="#local-6989586621680893445"><span class="hs-identifier hs-var">previousDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680893447"><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893447"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann -&gt; m (UniqueInfo ann)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893447"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="annottext">Maybe (UniqueInfo ann)
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680893453"><span class="annot"><span class="annottext">empty :: (Maybe a, Set (ScopedLoc ann))
</span><a href="#local-6989586621680893453"><span class="hs-identifier hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>            </span><span class="annot"><span class="annottext">(UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ())
-&gt; (UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; UniqueInfo ann -&gt; UniqueInfos ann -&gt; UniqueInfos ann
forall name unique1 unique2 a.
(HasUnique name unique1, Coercible unique2 Unique) =&gt;
name -&gt; a -&gt; UniqueMap unique2 a -&gt; UniqueMap unique2 a
</span><a href="PlutusCore.Name.html#insertByNameIndex"><span class="hs-identifier hs-var">insertByNameIndex</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893444"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
forall {a}. (Maybe a, Set (ScopedLoc ann))
</span><a href="#local-6989586621680893453"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-55"></span><span>            </span><span class="annot"><span class="annottext">UniqueInfo ann -&gt; m (UniqueInfo ann)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
forall {a}. (Maybe a, Set (ScopedLoc ann))
</span><a href="#local-6989586621680893453"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621680893192"><span id="local-6989586621680893193"><span id="local-6989586621680893194"><span id="local-6989586621680893195"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-type">addDef</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893192"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893193"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893194"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893192"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893195"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893192"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893195"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893193"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The variable</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893192"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The annotation of the variable</span></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The scope type</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893195"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-66"></span><span id="addDef"><span class="annot"><span class="annottext">addDef :: forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var hs-var">addDef</span></a></span></span><span> </span><span id="local-6989586621680893471"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893471"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680893472"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893472"><span class="hs-identifier hs-var">newDef</span></a></span></span><span> </span><span id="local-6989586621680893473"><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893473"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680893474"><span class="annot"><span class="annottext">def :: ScopedLoc ann
</span><a href="#local-6989586621680893474"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeType -&gt; ann -&gt; ScopedLoc ann
forall ann. ScopeType -&gt; ann -&gt; ScopedLoc ann
</span><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893473"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893472"><span class="hs-identifier hs-var">newDef</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621680893475"><span class="annot"><span class="annottext">d :: UniqueInfo ann
</span><a href="#local-6989586621680893475"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680893476"><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893476"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">n -&gt; m (UniqueInfo ann)
forall ann name unique (m :: * -&gt; *).
(Ord ann, HasUnique name unique, MonadState (UniqueInfos ann) m) =&gt;
name -&gt; m (UniqueInfo ann)
</span><a href="PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-var">lookupDef</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893471"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkUndefined"><span class="hs-identifier hs-var">checkUndefined</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893471"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><a href="#local-6989586621680893474"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893475"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="annottext">(UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ())
-&gt; (UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; UniqueInfo ann -&gt; UniqueInfos ann -&gt; UniqueInfos ann
forall name unique1 unique2 a.
(HasUnique name unique1, Coercible unique2 Unique) =&gt;
name -&gt; a -&gt; UniqueMap unique2 a -&gt; UniqueMap unique2 a
</span><a href="PlutusCore.Name.html#insertByNameIndex"><span class="hs-identifier hs-var">insertByNameIndex</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893471"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopedLoc ann -&gt; Maybe (ScopedLoc ann)
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><a href="#local-6989586621680893474"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893476"><span class="hs-identifier hs-var">uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | Check that a variable is currently undefined.</span></span><span>
</span><span id="line-74"></span><span id="local-6989586621680893203"><span id="local-6989586621680893204"><span id="local-6989586621680893205"><span id="local-6989586621680893206"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#checkUndefined"><span class="hs-identifier hs-type">checkUndefined</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893203"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893204"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893205"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893206"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893205"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893206"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893203"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The variable</span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893205"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The new definition</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893205"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The existing info</span></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-82"></span><span id="checkUndefined"><span class="annot"><span class="annottext">checkUndefined :: forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkUndefined"><span class="hs-identifier hs-var hs-var">checkUndefined</span></a></span></span><span> </span><span id="local-6989586621680893488"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893488"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680893489"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893489"><span class="hs-identifier hs-var">newDef</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680893490"><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893490"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893490"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680893491"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893491"><span class="hs-identifier hs-var">prevDef</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UniqueError ann] -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique -&gt; ann -&gt; ann -&gt; UniqueError ann
forall ann. Unique -&gt; ann -&gt; ann -&gt; UniqueError ann
</span><a href="PlutusCore.Error.html#MultiplyDefined"><span class="hs-identifier hs-var">MultiplyDefined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893488"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; Getting Unique n Unique -&gt; Unique
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Unique n Unique
forall name unique. HasUnique name unique =&gt; Lens' name Unique
Lens' n Unique
</span><a href="PlutusCore.Name.html#theUnique"><span class="hs-identifier hs-var">theUnique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893491"><span class="hs-identifier hs-var">prevDef</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893489"><span class="hs-identifier hs-var">newDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><span class="hs-identifier">_</span></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621680893494"><span id="local-6989586621680893495"><span id="local-6989586621680893496"><span id="local-6989586621680893497"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-type">addUsage</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893494"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893495"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893496"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893494"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893497"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893494"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893497"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893495"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The variable</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893494"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The annotation of the variable</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The scope type</span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893497"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-95"></span><span id="addUsage"><span class="annot"><span class="annottext">addUsage :: forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-var hs-var">addUsage</span></a></span></span><span> </span><span id="local-6989586621680893517"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893517"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680893518"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893518"><span class="hs-identifier hs-var">newUse</span></a></span></span><span> </span><span id="local-6989586621680893519"><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893519"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680893520"><span class="annot"><span class="annottext">use :: ScopedLoc ann
</span><a href="#local-6989586621680893520"><span class="hs-identifier hs-var hs-var">use</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeType -&gt; ann -&gt; ScopedLoc ann
forall ann. ScopeType -&gt; ann -&gt; ScopedLoc ann
</span><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893519"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893518"><span class="hs-identifier hs-var">newUse</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621680893521"><span class="annot"><span class="annottext">d :: UniqueInfo ann
</span><a href="#local-6989586621680893521"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680893522"><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893522"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680893523"><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893523"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">n -&gt; m (UniqueInfo ann)
forall ann name unique (m :: * -&gt; *).
(Ord ann, HasUnique name unique, MonadState (UniqueInfos ann) m) =&gt;
name -&gt; m (UniqueInfo ann)
</span><a href="PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-var">lookupDef</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893517"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkCoherency"><span class="hs-identifier hs-var">checkCoherency</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893517"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><a href="#local-6989586621680893520"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893521"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkDefined"><span class="hs-identifier hs-var">checkDefined</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893517"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><a href="#local-6989586621680893520"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueInfo ann
</span><a href="#local-6989586621680893521"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><span class="annottext">(UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ())
-&gt; (UniqueInfos ann -&gt; UniqueInfos ann) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; UniqueInfo ann -&gt; UniqueInfos ann -&gt; UniqueInfos ann
forall name unique1 unique2 a.
(HasUnique name unique1, Coercible unique2 Unique) =&gt;
name -&gt; a -&gt; UniqueMap unique2 a -&gt; UniqueMap unique2 a
</span><a href="PlutusCore.Name.html#insertByNameIndex"><span class="hs-identifier hs-var">insertByNameIndex</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893517"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893522"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann -&gt; Set (ScopedLoc ann) -&gt; Set (ScopedLoc ann)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><a href="#local-6989586621680893520"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893523"><span class="hs-identifier hs-var">uses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621680893527"><span id="local-6989586621680893528"><span id="local-6989586621680893529"><span id="local-6989586621680893530"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#checkDefined"><span class="hs-identifier hs-type">checkDefined</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893527"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893528"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893529"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893530"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893527"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The variable</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893529"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The new definition</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893529"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The existing info</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-110"></span><span id="checkDefined"><span class="annot"><span class="annottext">checkDefined :: forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkDefined"><span class="hs-identifier hs-var hs-var">checkDefined</span></a></span></span><span> </span><span id="local-6989586621680893540"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893540"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680893541"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893541"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680893542"><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893542"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893542"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UniqueError ann] -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique -&gt; ann -&gt; UniqueError ann
forall ann. Unique -&gt; ann -&gt; UniqueError ann
</span><a href="PlutusCore.Error.html#FreeVariable"><span class="hs-identifier hs-var">FreeVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893540"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; Getting Unique n Unique -&gt; Unique
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Unique n Unique
forall name unique. HasUnique name unique =&gt; Lens' name Unique
Lens' n Unique
</span><a href="PlutusCore.Name.html#theUnique"><span class="hs-identifier hs-var">theUnique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893541"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span id="local-6989586621680893226"><span id="local-6989586621680893227"><span id="local-6989586621680893228"><span id="local-6989586621680893229"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#checkCoherency"><span class="hs-identifier hs-type">checkCoherency</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893226"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893227"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893228"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893226"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The variable</span></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893228"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The new definition</span></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893228"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The existing info</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893229"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-121"></span><span id="checkCoherency"><span class="annot"><span class="annottext">checkCoherency :: forall n u ann (m :: * -&gt; *).
(HasUnique n u, MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ScopedLoc ann -&gt; UniqueInfo ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#checkCoherency"><span class="hs-identifier hs-var hs-var">checkCoherency</span></a></span></span><span> </span><span id="local-6989586621680893562"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893562"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span id="local-6989586621680893563"><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893563"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621680893564"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893564"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680893565"><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893565"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680893566"><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893566"><span class="hs-identifier hs-var">uses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann) -&gt; (ScopedLoc ann -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#for_"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ScopedLoc ann)
</span><a href="#local-6989586621680893565"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann -&gt; m ()
forall {f :: * -&gt; *}.
MonadWriter [UniqueError ann] f =&gt;
ScopedLoc ann -&gt; f ()
</span><a href="#local-6989586621680893568"><span class="hs-identifier hs-var">checkLoc</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">[ScopedLoc ann] -&gt; (ScopedLoc ann -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#for_"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (ScopedLoc ann) -&gt; [ScopedLoc ann]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (ScopedLoc ann)
</span><a href="#local-6989586621680893566"><span class="hs-identifier hs-var">uses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopedLoc ann -&gt; m ()
forall {f :: * -&gt; *}.
MonadWriter [UniqueError ann] f =&gt;
ScopedLoc ann -&gt; f ()
</span><a href="#local-6989586621680893568"><span class="hs-identifier hs-var">checkLoc</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621680893568"><span class="annot"><span class="annottext">checkLoc :: ScopedLoc ann -&gt; f ()
</span><a href="#local-6989586621680893568"><span class="hs-identifier hs-var hs-var">checkLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a></span><span> </span><span id="local-6989586621680893589"><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893589"><span class="hs-identifier hs-var">tpe'</span></a></span></span><span> </span><span id="local-6989586621680893590"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893590"><span class="hs-identifier hs-var">loc'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893589"><span class="hs-identifier hs-var">tpe'</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType -&gt; ScopeType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="#local-6989586621680893563"><span class="hs-identifier hs-var">tpe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">[UniqueError ann] -&gt; f ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique -&gt; ann -&gt; ann -&gt; UniqueError ann
forall ann. Unique -&gt; ann -&gt; ann -&gt; UniqueError ann
</span><a href="PlutusCore.Error.html#IncoherentUsage"><span class="hs-identifier hs-var">IncoherentUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621680893562"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; Getting Unique n Unique -&gt; Unique
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Unique n Unique
forall name unique. HasUnique name unique =&gt; Lens' name Unique
Lens' n Unique
</span><a href="PlutusCore.Name.html#theUnique"><span class="hs-identifier hs-var">theUnique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893590"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893564"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Given a PLC term, add all of its term and type definitions and usages, including its subterms</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- and subtypes, to a global map.</span><span>
</span><span id="line-131"></span><span id="local-6989586621680893250"><span id="local-6989586621680893251"><span id="local-6989586621680893253"><span id="local-6989586621680893255"><span id="local-6989586621680893256"><span id="local-6989586621680893257"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier hs-type">termDefs</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893250"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893251"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893253"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893250"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893255"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893250"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893255"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893253"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893251"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893256"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893257"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893250"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893255"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-139"></span><span id="termDefs"><span class="annot"><span class="annottext">termDefs :: forall ann name tyname (m :: * -&gt; *) (uni :: * -&gt; *) fun.
(Ord ann, HasUnique name TermUnique, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Term tyname name uni fun ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier hs-var hs-var">termDefs</span></a></span></span><span> </span><span id="local-6989586621680893619"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621680893619"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>   </span><span class="annot"><span class="annottext">Getting
  (Sequenced () m)
  (Term tyname name uni fun ann)
  (Term tyname name uni fun ann)
-&gt; Term tyname name uni fun ann
-&gt; (Term tyname name uni fun ann -&gt; m ())
-&gt; m ()
forall (m :: * -&gt; *) r s a.
Monad m =&gt;
Getting (Sequenced r m) s a -&gt; s -&gt; (a -&gt; m r) -&gt; m ()
</span><span class="hs-identifier hs-var">forMOf_</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Sequenced () m)
  (Term tyname name uni fun ann)
  (Term tyname name uni fun ann)
forall tyname name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
(Contravariant f, Applicative f) =&gt;
(Term tyname name uni fun ann -&gt; f (Term tyname name uni fun ann))
-&gt; Term tyname name uni fun ann -&gt; f (Term tyname name uni fun ann)
</span><a href="PlutusCore.Core.Plated.html#termSubtermsDeep"><span class="hs-identifier hs-var">termSubtermsDeep</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621680893619"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann -&gt; m ()
forall ann name tyname (m :: * -&gt; *) (uni :: * -&gt; *) fun.
(Ord ann, HasUnique name TermUnique, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Term tyname name uni fun ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#handleTerm"><span class="hs-identifier hs-var">handleTerm</span></a></span><span>
</span><span id="line-141"></span><span>   </span><span class="annot"><span class="annottext">Getting
  (Sequenced () m)
  (Term tyname name uni fun ann)
  (Type tyname uni ann)
-&gt; Term tyname name uni fun ann
-&gt; (Type tyname uni ann -&gt; m ())
-&gt; m ()
forall (m :: * -&gt; *) r s a.
Monad m =&gt;
Getting (Sequenced r m) s a -&gt; s -&gt; (a -&gt; m r) -&gt; m ()
</span><span class="hs-identifier hs-var">forMOf_</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Sequenced () m)
  (Term tyname name uni fun ann)
  (Type tyname uni ann)
forall tyname name (uni :: * -&gt; *) fun ann (f :: * -&gt; *).
(Contravariant f, Applicative f) =&gt;
(Type tyname uni ann -&gt; f (Type tyname uni ann))
-&gt; Term tyname name uni fun ann -&gt; f (Term tyname name uni fun ann)
</span><a href="PlutusCore.Core.Plated.html#termSubtypesDeep"><span class="hs-identifier hs-var">termSubtypesDeep</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621680893619"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann -&gt; m ()
forall ann tyname (m :: * -&gt; *) (uni :: * -&gt; *).
(Ord ann, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Type tyname uni ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#handleType"><span class="hs-identifier hs-var">handleType</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span id="local-6989586621680893623"><span id="local-6989586621680893624"><span id="local-6989586621680893625"><span id="local-6989586621680893626"><span id="local-6989586621680893627"><span id="local-6989586621680893628"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#handleTerm"><span class="hs-identifier hs-type">handleTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893623"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893624"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893625"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893623"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893626"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893623"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893626"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893625"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893624"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893627"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893628"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893623"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893626"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-150"></span><span id="handleTerm"><span class="annot"><span class="annottext">handleTerm :: forall ann name tyname (m :: * -&gt; *) (uni :: * -&gt; *) fun.
(Ord ann, HasUnique name TermUnique, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Term tyname name uni fun ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#handleTerm"><span class="hs-identifier hs-var hs-var">handleTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680893650"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893650"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893651"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893651"><span class="hs-identifier hs-var">n</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">name -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893651"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893650"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier hs-var">TermScope</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621680893653"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893653"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893654"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893654"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="annottext">name -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680893654"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893653"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier hs-var">TermScope</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span id="local-6989586621680893656"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893656"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893657"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893657"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><span class="annottext">tyname -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893657"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893656"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- | Given a type, add its type definition/usage, including its subtypes, to a global map.</span></span><span>
</span><span id="line-160"></span><span id="local-6989586621680893288"><span id="local-6989586621680893289"><span id="local-6989586621680893290"><span id="local-6989586621680893291"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#handleType"><span class="hs-identifier hs-type">handleType</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893288"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893289"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893288"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680893290"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893288"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680893290"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893289"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893291"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893288"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893290"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-167"></span><span id="handleType"><span class="annot"><span class="annottext">handleType :: forall ann tyname (m :: * -&gt; *) (uni :: * -&gt; *).
(Ord ann, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Type tyname uni ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#handleType"><span class="hs-identifier hs-var hs-var">handleType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span id="local-6989586621680893678"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893678"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893679"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893679"><span class="hs-identifier hs-var">n</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">tyname -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893679"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893678"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span id="local-6989586621680893681"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893681"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893682"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893682"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">tyname -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893682"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893681"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-type">TyLam</span></a></span><span> </span><span id="local-6989586621680893684"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893684"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680893685"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893685"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">tyname -&gt; ann -&gt; ScopeType -&gt; m ()
forall ann n unique (m :: * -&gt; *).
(Ord ann, HasUnique n unique, MonadState (UniqueInfos ann) m,
 MonadWriter [UniqueError ann] m) =&gt;
n -&gt; ann -&gt; ScopeType -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621680893685"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680893684"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeType
</span><a href="PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span id="local-6989586621680893303"><span id="local-6989586621680893304"><span id="local-6989586621680893305"><span id="local-6989586621680893306"><span id="local-6989586621680893307"><span id="local-6989586621680893308"><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#runTermDefs"><span class="hs-identifier hs-type">runTermDefs</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893303"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893304"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893305"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893306"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893305"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893304"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893307"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893308"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893303"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680893306"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893303"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680893303"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-183"></span><span id="runTermDefs"><span class="annot"><span class="annottext">runTermDefs :: forall ann name tyname (m :: * -&gt; *) (uni :: * -&gt; *) fun.
(Ord ann, HasUnique name TermUnique, HasUnique tyname TypeUnique,
 Monad m) =&gt;
Term tyname name uni fun ann
-&gt; m (UniqueInfos ann, [UniqueError ann])
</span><a href="PlutusCore.Analysis.Definitions.html#runTermDefs"><span class="hs-identifier hs-var hs-var">runTermDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriterT [UniqueError ann] m (UniqueInfos ann)
-&gt; m (UniqueInfos ann, [UniqueError ann])
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT [UniqueError ann] m (UniqueInfos ann)
 -&gt; m (UniqueInfos ann, [UniqueError ann]))
-&gt; (Term tyname name uni fun ann
    -&gt; WriterT [UniqueError ann] m (UniqueInfos ann))
-&gt; Term tyname name uni fun ann
-&gt; m (UniqueInfos ann, [UniqueError ann])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ()
 -&gt; UniqueInfos ann
 -&gt; WriterT [UniqueError ann] m (UniqueInfos ann))
-&gt; UniqueInfos ann
-&gt; StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ()
-&gt; WriterT [UniqueError ann] m (UniqueInfos ann)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ()
-&gt; UniqueInfos ann -&gt; WriterT [UniqueError ann] m (UniqueInfos ann)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="annot"><span class="annottext">UniqueInfos ann
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ()
 -&gt; WriterT [UniqueError ann] m (UniqueInfos ann))
-&gt; (Term tyname name uni fun ann
    -&gt; StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ())
-&gt; Term tyname name uni fun ann
-&gt; WriterT [UniqueError ann] m (UniqueInfos ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
-&gt; StateT (UniqueInfos ann) (WriterT [UniqueError ann] m) ()
forall ann name tyname (m :: * -&gt; *) (uni :: * -&gt; *) fun.
(Ord ann, HasUnique name TermUnique, HasUnique tyname TypeUnique,
 MonadState (UniqueInfos ann) m, MonadWriter [UniqueError ann] m) =&gt;
Term tyname name uni fun ann -&gt; m ()
</span><a href="PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier hs-var">termDefs</span></a></span><span>
</span><span id="line-184"></span></pre></body></html>