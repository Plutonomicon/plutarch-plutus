<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE StrictData        #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications  #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusLedgerApi.Common.Eval</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier">EvaluationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier">EvaluationContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier">AsScriptDecodeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier">LogOutput</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier">VerboseMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier">evaluateScriptRestricting</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier">evaluateScriptCounting</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-identifier">evaluateTerm</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier">mkDynEvaluationContext</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier">toMachineParameters</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier">mkTermToEvaluate</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier">assertWellFormedCostModelParams</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Builtin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readKnown</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Data</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Default</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Evaluation.Machine.CostModelInterface</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Evaluation.Machine.ExBudget</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Evaluation.Machine.ExBudgetingDefaults</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Evaluation.Machine.MachineParameters.Default</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.MkPlc</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Pretty</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html"><span class="hs-identifier">PlutusLedgerApi.Common.SerialisedScript</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html"><span class="hs-identifier">PlutusLedgerApi.Common.Versions</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusPrelude</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UntypedPlutusCore</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UntypedPlutusCore.Evaluation.Machine.Cek</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Lens</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier">MonadError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#liftEither"><span class="hs-identifier">liftEither</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier">runExceptT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.html"><span class="hs-identifier">Control.Monad.Writer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.Class.html#MonadWriter"><span class="hs-identifier">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Writer.Lazy.html#runWriter"><span class="hs-identifier">runWriter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html"><span class="hs-identifier">Data.Tuple</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><span class="hs-comment">-- | Errors that can be thrown when evaluating a Plutus script.</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">data</span><span> </span><span id="EvaluationError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-var">EvaluationError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>    </span><span id="CekError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-var">CekError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.CekEvaluationException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ An error from the evaluator itself</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DeBruijnError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-var">DeBruijnError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">FreeVariableError</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ An error in the pre-evaluation step of converting from de-Bruijn indices</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CodecError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CodecError"><span class="hs-identifier hs-var">CodecError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptDecodeError"><span class="hs-identifier hs-type">ScriptDecodeError</span></a></span><span> </span><span class="hs-comment">-- ^ A deserialisation error</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- TODO: make this error more informative when we have more information about what went wrong</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CostModelParameterMismatch"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CostModelParameterMismatch"><span class="hs-identifier hs-var">CostModelParameterMismatch</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ An error indicating that the cost model parameters didn't match what we expected</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="InvalidReturnValue"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#InvalidReturnValue"><span class="hs-identifier hs-var">InvalidReturnValue</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The script evaluated to a value that is not a valid return value.</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681020927"><span id="local-6989586621681020941"><span id="local-6989586621681020945"><span class="annot"><span class="annottext">Int -&gt; EvaluationError -&gt; ShowS
[EvaluationError] -&gt; ShowS
EvaluationError -&gt; [Char]
(Int -&gt; EvaluationError -&gt; ShowS)
-&gt; (EvaluationError -&gt; [Char])
-&gt; ([EvaluationError] -&gt; ShowS)
-&gt; Show EvaluationError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; EvaluationError -&gt; ShowS
showsPrec :: Int -&gt; EvaluationError -&gt; ShowS
$cshow :: EvaluationError -&gt; [Char]
show :: EvaluationError -&gt; [Char]
$cshowList :: [EvaluationError] -&gt; ShowS
showList :: [EvaluationError] -&gt; ShowS
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681021044"><span id="local-6989586621681021054"><span class="annot"><span class="annottext">EvaluationError -&gt; EvaluationError -&gt; Bool
(EvaluationError -&gt; EvaluationError -&gt; Bool)
-&gt; (EvaluationError -&gt; EvaluationError -&gt; Bool)
-&gt; Eq EvaluationError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: EvaluationError -&gt; EvaluationError -&gt; Bool
== :: EvaluationError -&gt; EvaluationError -&gt; Bool
$c/= :: EvaluationError -&gt; EvaluationError -&gt; Bool
/= :: EvaluationError -&gt; EvaluationError -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span id="AsEvaluationError"><span id="local-6989586621681020570"><span id="local-6989586621681021103"><span id="local-6989586621681021113"><span id="local-6989586621681021122"><span id="local-6989586621681021131"><span id="local-6989586621681021140"><span id="local-6989586621681021150"><span id="local-6989586621681021154"><span id="local-6989586621681021160"><span id="local-6989586621681021166"><span id="local-6989586621681021172"><span id="local-6989586621681021178"><span id="_EvaluationError"><span id="_CekError"><span id="_DeBruijnError"><span id="_CodecError"><span id="_CostModelParameterMismatch"><span id="_InvalidReturnValue"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EvaluationError</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681021206"><span id="local-6989586621681021214"><span id="local-6989586621681021221"><span id="local-6989586621681021228"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier hs-type">AsScriptDecodeError</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621681021240"><span class="annot"><span class="annottext">_ScriptDecodeError :: Prism' EvaluationError ScriptDecodeError
</span><a href="#local-6989586621681021240"><span class="hs-identifier hs-var hs-var hs-var hs-var">_ScriptDecodeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p ScriptDecodeError (f ScriptDecodeError)
-&gt; p EvaluationError (f EvaluationError)
forall r. AsEvaluationError r =&gt; Prism' r ScriptDecodeError
Prism' EvaluationError ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.Eval.html#_CodecError"><span class="hs-identifier hs-var">_CodecError</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681021244"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621681021321"><span class="annot"><span class="annottext">pretty :: forall ann. EvaluationError -&gt; Doc ann
</span><a href="#local-6989586621681021321"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-type">CekError</span></a></span><span> </span><span id="local-6989586621681021323"><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621681021323"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; Doc ann
forall a ann. PrettyClassic a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyClassic</span></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621681021323"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-type">DeBruijnError</span></a></span><span> </span><span id="local-6989586621681021325"><span class="annot"><span class="annottext">FreeVariableError
</span><a href="#local-6989586621681021325"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVariableError -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. FreeVariableError -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">FreeVariableError
</span><a href="#local-6989586621681021325"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CodecError"><span class="hs-identifier hs-type">CodecError</span></a></span><span> </span><span id="local-6989586621681021326"><span class="annot"><span class="annottext">ScriptDecodeError
</span><a href="#local-6989586621681021326"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptDecodeError -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. ScriptDecodeError -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ScriptDecodeError
</span><a href="#local-6989586621681021326"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#CostModelParameterMismatch"><span class="hs-identifier hs-var">CostModelParameterMismatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Cost model parameters were not as we expected&quot;</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#InvalidReturnValue"><span class="hs-identifier hs-var">InvalidReturnValue</span></a></span><span>         </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The evaluation finished but the result value is not valid. &quot;</span></span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Plutus V3 scripts must return BuiltinUnit. &quot;</span></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Returning any other value is considered a failure.&quot;</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | A simple toggle indicating whether or not we should accumulate logs during script execution.</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">data</span><span> </span><span id="VerboseMode"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-var">VerboseMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>    </span><span id="Verbose"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ accumulate all traces</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Quiet"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#Quiet"><span class="hs-identifier hs-var">Quiet</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ don't accumulate anything</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681021330"><span id="local-6989586621681021332"><span class="annot"><span class="annottext">VerboseMode -&gt; VerboseMode -&gt; Bool
(VerboseMode -&gt; VerboseMode -&gt; Bool)
-&gt; (VerboseMode -&gt; VerboseMode -&gt; Bool) -&gt; Eq VerboseMode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: VerboseMode -&gt; VerboseMode -&gt; Bool
== :: VerboseMode -&gt; VerboseMode -&gt; Bool
$c/= :: VerboseMode -&gt; VerboseMode -&gt; Bool
/= :: VerboseMode -&gt; VerboseMode -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><span class="hs-comment">{-| The type of the executed script's accumulated log output: a list of 'Text'.

It will be an empty list if the `VerboseMode` is set to `Quiet`.
-}</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">type</span><span> </span><span id="LogOutput"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-var">LogOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="annot"><span class="hs-comment">{-| Shared helper for the evaluation functions: 'evaluateScriptCounting' and 'evaluateScriptRestricting',

Given a 'ScriptForEvaluation':

1) applies the term to a list of 'Data' arguments (e.g. Datum, Redeemer, `ScriptContext`)
2) checks that the applied-term is well-scoped
3) returns the applied-term
-}</span></span><span>
</span><span id="line-93"></span><span id="local-6989586621681020634"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-type">mkTermToEvaluate</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681020634"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the Plutus ledger language of the script under execution.</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ which major protocol version to run the operation in</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForEvaluation"><span class="hs-identifier hs-type">ScriptForEvaluation</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the script to evaluate</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.Data</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ the arguments that the script's underlying term will be applied to</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681020634"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-100"></span><span id="mkTermToEvaluate"><span class="annot"><span class="annottext">mkTermToEvaluate :: forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var hs-var">mkTermToEvaluate</span></a></span></span><span> </span><span id="local-6989586621681021362"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021362"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021363"><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021363"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621681021364"><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021364"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span id="local-6989586621681021365"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021365"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptNamedDeBruijn"><span class="hs-identifier hs-type">ScriptNamedDeBruijn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681021368"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681021368"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681021369"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021369"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptForEvaluation -&gt; ScriptNamedDeBruijn
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#deserialisedScript"><span class="hs-identifier hs-var">deserialisedScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021364"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621681021379"><span class="annot"><span class="annottext">termArgs :: [Term NamedDeBruijn DefaultUni DefaultFun ()]
</span><a href="#local-6989586621681021379"><span class="hs-identifier hs-var hs-var">termArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Data -&gt; Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; [Data] -&gt; [Term NamedDeBruijn DefaultUni DefaultFun ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Data -&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
forall a (uni :: * -&gt; *) fun (term :: * -&gt; *) tyname name ann.
(TermLike term tyname name uni fun, HasTermLevel uni a) =&gt;
ann -&gt; a -&gt; term ann
</span><span class="hs-identifier hs-var">UPLC.mkConstant</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021365"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span id="local-6989586621681021382"><span class="annot"><span class="annottext">appliedT :: Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021382"><span class="hs-identifier hs-var hs-var">appliedT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; [Term NamedDeBruijn DefaultUni DefaultFun ()]
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
forall (term :: * -&gt; *) tyname name (uni :: * -&gt; *) fun.
TermLike term tyname name uni fun =&gt;
term () -&gt; [term ()] -&gt; term ()
</span><span class="hs-identifier hs-var">UPLC.mkIterAppNoAnn</span></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021369"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Term NamedDeBruijn DefaultUni DefaultFun ()]
</span><a href="#local-6989586621681021379"><span class="hs-identifier hs-var">termArgs</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- check that the Plutus Core language version is available</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- See Note [Checking the Plutus Core language version]</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681021368"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Set Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; MajorProtocolVersion -&gt; Set Version
</span><a href="PlutusLedgerApi.Common.Versions.html#plcVersionsAvailableIn"><span class="hs-identifier hs-var">plcVersionsAvailableIn</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021362"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021363"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">AReview EvaluationError ScriptDecodeError
-&gt; ScriptDecodeError -&gt; m ()
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview EvaluationError ScriptDecodeError
forall r. AsScriptDecodeError r =&gt; Prism' r ScriptDecodeError
Prism' EvaluationError ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#_ScriptDecodeError"><span class="hs-identifier hs-var">_ScriptDecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptDecodeError -&gt; m ()) -&gt; ScriptDecodeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Version
-&gt; PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#PlutusCoreLanguageNotAvailableError"><span class="hs-identifier hs-var">PlutusCoreLanguageNotAvailableError</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681021368"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021362"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021363"><span class="hs-identifier hs-var">pv</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-comment">-- make sure that term is closed, i.e. well-scoped</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">(Term NamedDeBruijn DefaultUni DefaultFun () -&gt; m ())
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; f b) -&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">through</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either EvaluationError () -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#liftEither"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either EvaluationError () -&gt; m ())
-&gt; (Term NamedDeBruijn DefaultUni DefaultFun ()
    -&gt; Either EvaluationError ())
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FreeVariableError -&gt; EvaluationError)
-&gt; Either FreeVariableError () -&gt; Either EvaluationError ()
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariableError -&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-var">DeBruijnError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FreeVariableError () -&gt; Either EvaluationError ())
-&gt; (Term NamedDeBruijn DefaultUni DefaultFun ()
    -&gt; Either FreeVariableError ())
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Either EvaluationError ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Either FreeVariableError ()
forall e (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(HasIndex name, MonadError e m, AsFreeVariableError e) =&gt;
Term name uni fun a -&gt; m ()
</span><span class="hs-identifier hs-var">UPLC.checkScope</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021382"><span class="hs-identifier hs-var">appliedT</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-type">toMachineParameters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultMachineParameters</span></span><span>
</span><span id="line-114"></span><span id="toMachineParameters"><span class="annot"><span class="annottext">toMachineParameters :: MajorProtocolVersion
-&gt; EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-var hs-var">toMachineParameters</span></a></span></span><span> </span><span id="local-6989586621681021391"><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021391"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span> </span><span id="local-6989586621681021393"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021393"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021394"><span class="annot"><span class="annottext">MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun
</span><a href="#local-6989586621681021394"><span class="hs-identifier hs-var">toSemVar</span></a></span></span><span> </span><span id="local-6989586621681021395"><span class="annot"><span class="annottext">[(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
</span><a href="#local-6989586621681021395"><span class="hs-identifier hs-var">machParsList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuiltinSemanticsVariant DefaultFun
-&gt; [(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
-&gt; Maybe DefaultMachineParameters
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun
</span><a href="#local-6989586621681021394"><span class="hs-identifier hs-var">toSemVar</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021391"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
</span><a href="#local-6989586621681021395"><span class="hs-identifier hs-var">machParsList</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">Maybe DefaultMachineParameters
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DefaultMachineParameters
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; DefaultMachineParameters)
-&gt; [Char] -&gt; DefaultMachineParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">Prelude.concat</span></a></span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Internal error: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021393"><span class="hs-identifier hs-var">ll</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; does not support protocol version &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021391"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681021400"><span class="annot"><span class="annottext">DefaultMachineParameters
</span><a href="#local-6989586621681021400"><span class="hs-identifier hs-var">machPars</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DefaultMachineParameters
</span><a href="#local-6989586621681021400"><span class="hs-identifier hs-var">machPars</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><span class="hs-comment">{-| An opaque type that contains all the static parameters that the evaluator needs to evaluate a
script. This is so that they can be computed once and cached, rather than being recomputed on every
evaluation.

Different protocol versions may require different bundles of machine parameters, which allows us for
example to tweak the shape of the costing function of a builtin, so that the builtin costs less.
Currently this means that we have to create multiple 'DefaultMachineParameters' per language
version, which we put into a cache (represented by an association list) in order to avoid costly
recomputation of machine parameters.

In order to get the appropriate 'DefaultMachineParameters' at validation time we look it up in the
cache using a semantics variant as a key. We compute the semantics variant from the protocol
version using the stored function. Note that the semantics variant depends on the language version
too, but the latter is known statically (because each language version has its own evaluation
context), hence there's no reason to require it to be provided at runtime.

To say it differently, there's a matrix of semantics variants indexed by (LL, PV) pairs and we
cache its particular row corresponding to the statically given LL in an 'EvaluationContext'.

The reason why we associate a 'DefaultMachineParameters' with a semantics variant rather than a
protocol version are

1. generally there are far more protocol versions than semantics variants supported by a specific
   language version, so we save on pointless duplication of bundles of machine parameters
2. builtins don't know anything about protocol versions, only semantics variants. It is therefore
   more semantically precise to associate bundles of machine parameters with semantics variants than
   with protocol versions
-}</span></span><span>
</span><span id="line-148"></span><span class="hs-keyword">data</span><span> </span><span id="EvaluationContext"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EvaluationContext"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_evalCtxLedgerLang"><span class="annot"><span class="annottext">EvaluationContext -&gt; PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.Eval.html#_evalCtxLedgerLang"><span class="hs-identifier hs-var hs-var">_evalCtxLedgerLang</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Specifies what language versions the 'EvaluationContext' is for.</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_evalCtxToSemVar"><span class="annot"><span class="annottext">EvaluationContext
-&gt; MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun
</span><a href="PlutusLedgerApi.Common.Eval.html#_evalCtxToSemVar"><span class="hs-identifier hs-var hs-var">_evalCtxToSemVar</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuiltinSemanticsVariant</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-comment">-- ^ Specifies how to get a semantics variant for this ledger language given a</span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-comment">-- 'MajorProtocolVersion'.</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_evalCtxMachParsCache"><span class="annot"><span class="annottext">EvaluationContext
-&gt; [(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
</span><a href="PlutusLedgerApi.Common.Eval.html#_evalCtxMachParsCache"><span class="hs-identifier hs-var hs-var">_evalCtxMachParsCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BuiltinSemanticsVariant</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultMachineParameters</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-comment">-- ^ The cache of 'DefaultMachineParameters' for each semantics variant supported by the</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-comment">-- current language version.</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span id="local-6989586621681021406"><span id="local-6989586621681021408"><span class="annot"><span class="annottext">(forall x. EvaluationContext -&gt; Rep EvaluationContext x)
-&gt; (forall x. Rep EvaluationContext x -&gt; EvaluationContext)
-&gt; Generic EvaluationContext
forall x. Rep EvaluationContext x -&gt; EvaluationContext
forall x. EvaluationContext -&gt; Rep EvaluationContext x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. EvaluationContext -&gt; Rep EvaluationContext x
from :: forall x. EvaluationContext -&gt; Rep EvaluationContext x
$cto :: forall x. Rep EvaluationContext x -&gt; EvaluationContext
to :: forall x. Rep EvaluationContext x -&gt; EvaluationContext
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681021412"><span class="annot"><span class="annottext">EvaluationContext -&gt; ()
(EvaluationContext -&gt; ()) -&gt; NFData EvaluationContext
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: EvaluationContext -&gt; ()
rnf :: EvaluationContext -&gt; ()
</span><a href="../../../ghc-9.6.6/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681021463"><span id="local-6989586621681021467"><span id="local-6989586621681021473"><span class="annot"><span class="annottext">[[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
Proxy EvaluationContext -&gt; [Char]
([[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo))
-&gt; ([[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy EvaluationContext -&gt; [Char])
-&gt; NoThunks EvaluationContext
forall a.
([[Char]] -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; ([[Char]] -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; [Char])
-&gt; NoThunks a
$cnoThunks :: [[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
noThunks :: [[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: [[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
wNoThunks :: [[Char]] -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy EvaluationContext -&gt; [Char]
showTypeOf :: Proxy EvaluationContext -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-comment">{-|  Create an 'EvaluationContext' given all builtin semantics variants supported by the provided
language version.

The input is a `Map` of `Text`s to cost integer values (aka `Plutus.CostModelParams`, `Alonzo.CostModel`)
See Note [Inlining meanings of builtins].

IMPORTANT: the 'toSemVar' argument computes the semantics variant for each 'MajorProtocolVersion'
and it must only return semantics variants from the 'semVars' list, as well as cover ANY
'MajorProtocolVersion', including those that do not exist yet (i.e. 'toSemVar' must never fail).

IMPORTANT: The evaluation context of every Plutus version must be recreated upon a protocol update
with the updated cost model parameters.
-}</span></span><span>
</span><span id="line-174"></span><span id="local-6989586621681020790"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier hs-type">mkDynEvaluationContext</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CostModelApplyError</span></span><span> </span><span class="annot"><a href="#local-6989586621681020790"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">BuiltinSemanticsVariant</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuiltinSemanticsVariant</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.CostModelParams</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681020790"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span></span><span>
</span><span id="line-181"></span><span id="mkDynEvaluationContext"><span class="annot"><span class="annottext">mkDynEvaluationContext :: forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
PlutusLedgerLanguage
-&gt; [BuiltinSemanticsVariant DefaultFun]
-&gt; (MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun)
-&gt; CostModelParams
-&gt; m EvaluationContext
</span><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier hs-var hs-var">mkDynEvaluationContext</span></a></span></span><span> </span><span id="local-6989586621681021546"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021546"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021547"><span class="annot"><span class="annottext">[BuiltinSemanticsVariant DefaultFun]
</span><a href="#local-6989586621681021547"><span class="hs-identifier hs-var">semVars</span></a></span></span><span> </span><span id="local-6989586621681021548"><span class="annot"><span class="annottext">MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun
</span><a href="#local-6989586621681021548"><span class="hs-identifier hs-var">toSemVar</span></a></span></span><span> </span><span id="local-6989586621681021549"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621681021549"><span class="hs-identifier hs-var">newCMP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; (MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun)
-&gt; [(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
-&gt; EvaluationContext
</span><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021546"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion -&gt; BuiltinSemanticsVariant DefaultFun
</span><a href="#local-6989586621681021548"><span class="hs-identifier hs-var">toSemVar</span></a></span><span> </span><span class="annot"><span class="annottext">([(BuiltinSemanticsVariant DefaultFun, DefaultMachineParameters)]
 -&gt; EvaluationContext)
-&gt; m [(BuiltinSemanticsVariant DefaultFun,
       DefaultMachineParameters)]
-&gt; m EvaluationContext
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[BuiltinSemanticsVariant DefaultFun]
-&gt; CostModelParams
-&gt; m [(BuiltinSemanticsVariant DefaultFun,
       DefaultMachineParameters)]
forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
[BuiltinSemanticsVariant DefaultFun]
-&gt; CostModelParams
-&gt; m [(BuiltinSemanticsVariant DefaultFun,
       DefaultMachineParameters)]
</span><span class="hs-identifier hs-var">mkMachineParametersFor</span></span><span> </span><span class="annot"><span class="annottext">[BuiltinSemanticsVariant DefaultFun]
</span><a href="#local-6989586621681021547"><span class="hs-identifier hs-var">semVars</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621681021549"><span class="hs-identifier hs-var">newCMP</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-comment">-- FIXME: remove this function</span><span>
</span><span id="line-185"></span><span id="local-6989586621681020797"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier hs-type">assertWellFormedCostModelParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CostModelApplyError</span></span><span> </span><span class="annot"><a href="#local-6989586621681020797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.CostModelParams</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681020797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-186"></span><span id="assertWellFormedCostModelParams"><span class="annot"><span class="annottext">assertWellFormedCostModelParams :: forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
CostModelParams -&gt; m ()
</span><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier hs-var hs-var">assertWellFormedCostModelParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (CostModel (CekMachineCostsBase Identity) BuiltinCostModel)
-&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(m (CostModel (CekMachineCostsBase Identity) BuiltinCostModel)
 -&gt; m ())
-&gt; (CostModelParams
    -&gt; m (CostModel (CekMachineCostsBase Identity) BuiltinCostModel))
-&gt; CostModelParams
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel (CekMachineCostsBase Identity) BuiltinCostModel
-&gt; CostModelParams
-&gt; m (CostModel (CekMachineCostsBase Identity) BuiltinCostModel)
forall evaluatorcosts builtincosts (m :: * -&gt; *).
(FromJSON evaluatorcosts, FromJSON builtincosts,
 ToJSON evaluatorcosts, ToJSON builtincosts,
 MonadError CostModelApplyError m) =&gt;
CostModel evaluatorcosts builtincosts
-&gt; CostModelParams -&gt; m (CostModel evaluatorcosts builtincosts)
</span><span class="hs-identifier hs-var">Plutus.applyCostModelParams</span></span><span> </span><span class="annot"><span class="annottext">CostModel (CekMachineCostsBase Identity) BuiltinCostModel
</span><span class="hs-identifier hs-var">Plutus.defaultCekCostModelForTesting</span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | Evaluate a fully-applied term using the CEK machine. Useful for mimicking the behaviour of the</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- on-chain evaluator.</span><span>
</span><span id="line-190"></span><span id="local-6989586621681020808"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-identifier hs-type">evaluateTerm</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.ExBudgetMode</span></span><span> </span><span class="annot"><a href="#local-6989586621681020808"><span class="hs-identifier hs-type">cost</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-type">VerboseMode</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.CekEvaluationException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681020808"><span class="hs-identifier hs-type">cost</span></a></span><span>
</span><span id="line-200"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-special">)</span></span><span>
</span><span id="line-202"></span><span id="evaluateTerm"><span class="annot"><span class="annottext">evaluateTerm :: forall cost.
ExBudgetMode cost DefaultUni DefaultFun
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    cost, LogOutput)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-identifier hs-var hs-var">evaluateTerm</span></a></span></span><span> </span><span id="local-6989586621681021620"><span class="annot"><span class="annottext">ExBudgetMode cost DefaultUni DefaultFun
</span><a href="#local-6989586621681021620"><span class="hs-identifier hs-var">budgetMode</span></a></span></span><span> </span><span id="local-6989586621681021621"><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021621"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621681021622"><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021622"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span id="local-6989586621681021623"><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021623"><span class="hs-identifier hs-var">ectx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">DefaultMachineParameters
-&gt; ExBudgetMode cost DefaultUni DefaultFun
-&gt; EmitterMode DefaultUni DefaultFun
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    cost, LogOutput)
forall (uni :: * -&gt; *) fun ann cost.
ThrowableBuiltins uni fun =&gt;
MachineParameters
  (CekMachineCostsBase Identity) fun (CekValue uni fun ann)
-&gt; ExBudgetMode cost uni fun
-&gt; EmitterMode uni fun
-&gt; NTerm uni fun ann
-&gt; (Either
      (CekEvaluationException NamedDeBruijn uni fun) (NTerm uni fun ()),
    cost, LogOutput)
</span><span class="hs-identifier hs-var">UPLC.runCekDeBruijn</span></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MajorProtocolVersion
-&gt; EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-var">toMachineParameters</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021621"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021623"><span class="hs-identifier hs-var">ectx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">ExBudgetMode cost DefaultUni DefaultFun
</span><a href="#local-6989586621681021620"><span class="hs-identifier hs-var">budgetMode</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021622"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode -&gt; VerboseMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="PlutusLedgerApi.Common.Eval.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EmitterMode DefaultUni DefaultFun
forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><span class="hs-identifier hs-var">UPLC.logEmitter</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">EmitterMode DefaultUni DefaultFun
forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><span class="hs-identifier hs-var">UPLC.noEmitter</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Just replicating the old behavior, probably doesn't matter.</span><span>
</span><span id="line-208"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-pragma hs-type">evaluateTerm</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><span class="hs-comment">{-| Evaluates a script, with a cost model and a budget that restricts how many
resources it can use according to the cost model. Also returns the budget that
was actually used.

Can be used to calculate budgets for scripts, but even in this case you must give
a limit to guard against scripts that run for a long time or loop.

Note: Parameterized over the 'LedgerPlutusVersion' since
1. The builtins allowed (during decoding) differ, and
2. The Plutus language versions allowed differ.
-}</span></span><span>
</span><span id="line-221"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier hs-type">evaluateScriptRestricting</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The Plutus ledger language of the script under execution.</span></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Which major protocol version to run the operation in</span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-type">VerboseMode</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether to produce log output</span></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Includes the cost model to use for tallying up the execution costs</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExBudget</span></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The resource budget which must not be exceeded during evaluation</span></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForEvaluation"><span class="hs-identifier hs-type">ScriptForEvaluation</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The script to evaluate</span></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.Data</span></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The arguments to the script</span></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExBudget</span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span id="evaluateScriptRestricting"><span class="annot"><span class="annottext">evaluateScriptRestricting :: PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; ExBudget
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; (LogOutput, Either EvaluationError ExBudget)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier hs-var hs-var">evaluateScriptRestricting</span></a></span></span><span> </span><span id="local-6989586621681021627"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021627"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021628"><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021628"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621681021629"><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021629"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span id="local-6989586621681021630"><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021630"><span class="hs-identifier hs-var">ectx</span></a></span></span><span> </span><span id="local-6989586621681021631"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021631"><span class="hs-identifier hs-var">budget</span></a></span></span><span> </span><span id="local-6989586621681021632"><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021632"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681021633"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021633"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either EvaluationError ExBudget, LogOutput)
-&gt; (LogOutput, Either EvaluationError ExBudget)
forall a b. (a, b) -&gt; (b, a)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#swap"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="annot"><span class="annottext">((Either EvaluationError ExBudget, LogOutput)
 -&gt; (LogOutput, Either EvaluationError ExBudget))
-&gt; (Either EvaluationError ExBudget, LogOutput)
-&gt; (LogOutput, Either EvaluationError ExBudget)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w a. Writer w a -&gt; (a, w)
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Writer.Lazy.html#runWriter"><span class="hs-identifier hs-var">runWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer LogOutput (Either EvaluationError ExBudget)
 -&gt; (Either EvaluationError ExBudget, LogOutput))
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
-&gt; (Either EvaluationError ExBudget, LogOutput)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
 -&gt; Writer LogOutput (Either EvaluationError ExBudget))
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621681021635"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021635"><span class="hs-identifier hs-var">appliedTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; ExceptT
     EvaluationError
     (WriterT LogOutput Identity)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var">mkTermToEvaluate</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021627"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021628"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021632"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021633"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681021687"><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021687"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.RestrictingSt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExRestrictingBudget</span></span><span> </span><span id="local-6989586621681021690"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021690"><span class="hs-identifier hs-var">final</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681021691"><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021691"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>            </span><span class="annot"><span class="annottext">ExBudgetMode RestrictingSt DefaultUni DefaultFun
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    RestrictingSt, LogOutput)
forall cost.
ExBudgetMode cost DefaultUni DefaultFun
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    cost, LogOutput)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-identifier hs-var">evaluateTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExRestrictingBudget
-&gt; ExBudgetMode RestrictingSt DefaultUni DefaultFun
forall (uni :: * -&gt; *) fun.
ThrowableBuiltins uni fun =&gt;
ExRestrictingBudget -&gt; ExBudgetMode RestrictingSt uni fun
</span><span class="hs-identifier hs-var">UPLC.restricting</span></span><span> </span><span class="annot"><span class="annottext">(ExRestrictingBudget
 -&gt; ExBudgetMode RestrictingSt DefaultUni DefaultFun)
-&gt; ExRestrictingBudget
-&gt; ExBudgetMode RestrictingSt DefaultUni DefaultFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget -&gt; ExRestrictingBudget
</span><span class="hs-identifier hs-var">ExRestrictingBudget</span></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021631"><span class="hs-identifier hs-var">budget</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021628"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021629"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021630"><span class="hs-identifier hs-var">ectx</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021635"><span class="hs-identifier hs-var">appliedTerm</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; LogOutput
-&gt; Either
     (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ()
forall (m :: * -&gt; *).
(MonadError EvaluationError m, MonadWriter LogOutput m) =&gt;
PlutusLedgerLanguage
-&gt; LogOutput
-&gt; Either
     (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; m ()
</span><a href="PlutusLedgerApi.Common.Eval.html#processLogsAndErrors"><span class="hs-identifier hs-var">processLogsAndErrors</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021627"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021691"><span class="hs-identifier hs-var">logs</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021687"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">ExBudget
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
forall a.
a -&gt; ExceptT EvaluationError (WriterT LogOutput Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021631"><span class="hs-identifier hs-var">budget</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget -&gt; ExBudget -&gt; ExBudget
</span><span class="hs-operator hs-var">`minusExBudget`</span></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021690"><span class="hs-identifier hs-var">final</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">{-| Evaluates a script, returning the minimum budget that the script would need
to evaluate successfully. This will take as long as the script takes, if you need to
limit the execution time of the script also, you can use 'evaluateScriptRestricting', which
also returns the used budget.

Note: Parameterized over the ledger-plutus-version since the builtins allowed (during decoding) differs.
-}</span></span><span>
</span><span id="line-244"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier hs-type">evaluateScriptCounting</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The Plutus ledger language of the script under execution.</span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#MajorProtocolVersion"><span class="hs-identifier hs-type">MajorProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Which major protocol version to run the operation in</span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-type">VerboseMode</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether to produce log output</span></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Includes the cost model to use for tallying up the execution costs</span></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForEvaluation"><span class="hs-identifier hs-type">ScriptForEvaluation</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The script to evaluate</span></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.Data</span></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The arguments to the script</span></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExBudget</span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span id="evaluateScriptCounting"><span class="annot"><span class="annottext">evaluateScriptCounting :: PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; (LogOutput, Either EvaluationError ExBudget)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier hs-var hs-var">evaluateScriptCounting</span></a></span></span><span> </span><span id="local-6989586621681021695"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021695"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021696"><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021696"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621681021697"><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021697"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span id="local-6989586621681021698"><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021698"><span class="hs-identifier hs-var">ectx</span></a></span></span><span> </span><span id="local-6989586621681021699"><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021699"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681021700"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021700"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either EvaluationError ExBudget, LogOutput)
-&gt; (LogOutput, Either EvaluationError ExBudget)
forall a b. (a, b) -&gt; (b, a)
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#swap"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="annot"><span class="annottext">((Either EvaluationError ExBudget, LogOutput)
 -&gt; (LogOutput, Either EvaluationError ExBudget))
-&gt; (Either EvaluationError ExBudget, LogOutput)
-&gt; (LogOutput, Either EvaluationError ExBudget)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w a. Writer w a -&gt; (a, w)
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Writer.Lazy.html#runWriter"><span class="hs-identifier hs-var">runWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer LogOutput (Either EvaluationError ExBudget)
 -&gt; (Either EvaluationError ExBudget, LogOutput))
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
-&gt; (Either EvaluationError ExBudget, LogOutput)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
 -&gt; Writer LogOutput (Either EvaluationError ExBudget))
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
-&gt; Writer LogOutput (Either EvaluationError ExBudget)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621681021701"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021701"><span class="hs-identifier hs-var">appliedTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; ExceptT
     EvaluationError
     (WriterT LogOutput Identity)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; MajorProtocolVersion
-&gt; ScriptForEvaluation
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var">mkTermToEvaluate</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021695"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021696"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptForEvaluation
</span><a href="#local-6989586621681021699"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621681021700"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681021702"><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021702"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.CountingSt</span></span><span> </span><span id="local-6989586621681021704"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021704"><span class="hs-identifier hs-var">final</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681021705"><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021705"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>            </span><span class="annot"><span class="annottext">ExBudgetMode CountingSt DefaultUni DefaultFun
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    CountingSt, LogOutput)
forall cost.
ExBudgetMode cost DefaultUni DefaultFun
-&gt; MajorProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; (Either
      (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
      (Term NamedDeBruijn DefaultUni DefaultFun ()),
    cost, LogOutput)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateTerm"><span class="hs-identifier hs-var">evaluateTerm</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudgetMode CountingSt DefaultUni DefaultFun
forall (uni :: * -&gt; *) fun. ExBudgetMode CountingSt uni fun
</span><span class="hs-identifier hs-var">UPLC.counting</span></span><span> </span><span class="annot"><span class="annottext">MajorProtocolVersion
</span><a href="#local-6989586621681021696"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621681021697"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621681021698"><span class="hs-identifier hs-var">ectx</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021701"><span class="hs-identifier hs-var">appliedTerm</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; LogOutput
-&gt; Either
     (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ()
forall (m :: * -&gt; *).
(MonadError EvaluationError m, MonadWriter LogOutput m) =&gt;
PlutusLedgerLanguage
-&gt; LogOutput
-&gt; Either
     (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; m ()
</span><a href="PlutusLedgerApi.Common.Eval.html#processLogsAndErrors"><span class="hs-identifier hs-var">processLogsAndErrors</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021695"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021705"><span class="hs-identifier hs-var">logs</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021702"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">ExBudget
-&gt; ExceptT EvaluationError (WriterT LogOutput Identity) ExBudget
forall a.
a -&gt; ExceptT EvaluationError (WriterT LogOutput Identity) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621681021704"><span class="hs-identifier hs-var">final</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#processLogsAndErrors"><span class="hs-identifier hs-type">processLogsAndErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681020833"><span class="annot"><a href="#local-6989586621681020833"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681020833"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.Class.html#MonadWriter"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681020833"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.CekEvaluationException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621681020833"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span id="processLogsAndErrors"><span class="annot"><span class="annottext">processLogsAndErrors :: forall (m :: * -&gt; *).
(MonadError EvaluationError m, MonadWriter LogOutput m) =&gt;
PlutusLedgerLanguage
-&gt; LogOutput
-&gt; Either
     (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
     (Term NamedDeBruijn DefaultUni DefaultFun ())
-&gt; m ()
</span><a href="PlutusLedgerApi.Common.Eval.html#processLogsAndErrors"><span class="hs-identifier hs-var hs-var">processLogsAndErrors</span></a></span></span><span> </span><span id="local-6989586621681021716"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021716"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021717"><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021717"><span class="hs-identifier hs-var">logs</span></a></span></span><span> </span><span id="local-6989586621681021718"><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021718"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">LogOutput -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.Class.html#tell"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621681021717"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621681021718"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681021720"><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621681021720"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationError -&gt; m ()
forall a. EvaluationError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-var">CekError</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621681021720"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681021722"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021722"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; Term NamedDeBruijn DefaultUni DefaultFun () -&gt; Bool
</span><a href="PlutusLedgerApi.Common.Eval.html#isResultValid"><span class="hs-identifier hs-var">isResultValid</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021716"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021722"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationError -&gt; m ()
forall a. EvaluationError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#InvalidReturnValue"><span class="hs-identifier hs-var">InvalidReturnValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#processLogsAndErrors"><span class="hs-pragma hs-type">processLogsAndErrors</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#isResultValid"><span class="hs-identifier hs-type">isResultValid</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-279"></span><span id="isResultValid"><span class="annot"><span class="annottext">isResultValid :: PlutusLedgerLanguage
-&gt; Term NamedDeBruijn DefaultUni DefaultFun () -&gt; Bool
</span><a href="PlutusLedgerApi.Common.Eval.html#isResultValid"><span class="hs-identifier hs-var hs-var">isResultValid</span></a></span></span><span> </span><span id="local-6989586621681021724"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021724"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621681021725"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021725"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021724"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; PlutusLedgerLanguage -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.Versions.html#PlutusV1"><span class="hs-identifier hs-var">PlutusV1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621681021724"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; PlutusLedgerLanguage -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.Versions.html#PlutusV2"><span class="hs-identifier hs-var">PlutusV2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun () -&gt; Bool
forall {val}. ReadKnownIn (UniOf val) val () =&gt; val -&gt; Bool
</span><a href="#local-6989586621681021729"><span class="hs-identifier hs-var">isBuiltinUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621681021725"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621681021729"><span class="annot"><span class="annottext">isBuiltinUnit :: val -&gt; Bool
</span><a href="#local-6989586621681021729"><span class="hs-identifier hs-var hs-var">isBuiltinUnit</span></a></span></span><span> </span><span id="local-6989586621681021733"><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681021733"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">val -&gt; ReadKnownM ()
forall (uni :: * -&gt; *) val a.
ReadKnownIn uni val a =&gt;
val -&gt; ReadKnownM a
</span><span class="hs-identifier hs-var">readKnown</span></span><span> </span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681021733"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>            </span><span class="annot"><a href="../../../ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">ReadKnownM ()
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-284"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#isResultValid"><span class="hs-pragma hs-type">isResultValid</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">{- Note [Checking the Plutus Core language version]
Since long ago this check has been in `mkTermToEvaluate`, which makes it a phase 2 failure.
But this is really far too strict: we can check when deserializing, so it can be a phase 1
failure, like the other such checks that we have. For now we keep it as it is, but we may
try to move it later.
-}</span><span>
</span><span id="line-292"></span></pre></body></html>