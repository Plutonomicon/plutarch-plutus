<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass  #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusLedgerApi.Common.SerialisedScript</span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier">SerialisedScript</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseCompiledCode"><span class="hs-identifier">serialiseCompiledCode</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseUPLC"><span class="hs-identifier">serialiseUPLC</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#uncheckedDeserialiseUPLC"><span class="hs-identifier">uncheckedDeserialiseUPLC</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#scriptCBORDecoder"><span class="hs-identifier">scriptCBORDecoder</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier">ScriptForExecution</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptDecodeError"><span class="hs-identifier">ScriptDecodeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier">AsScriptDecodeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#fromSerialisedScript"><span class="hs-identifier">fromSerialisedScript</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#assertScriptWellFormed"><span class="hs-identifier">assertScriptWellFormed</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html"><span class="hs-identifier">PlutusLedgerApi.Common.Versions</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Code</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UntypedPlutusCore</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.CBOR.Extras.html"><span class="hs-identifier">Codec.CBOR.Extras</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Read</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator">(&gt;&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Lens</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromStrict</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Coerce.html"><span class="hs-identifier">Data.Coerce</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><span class="hs-comment">-- | An error that occurred during script deserialization.</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">data</span><span> </span><span id="ScriptDecodeError"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptDecodeError"><span class="hs-identifier hs-var">ScriptDecodeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-40"></span><span>      </span><span id="CBORDeserialiseError"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#CBORDeserialiseError"><span class="hs-identifier hs-var">CBORDeserialiseError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">CBOR.DeserialiseFailure</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ an error from the underlying CBOR/serialise library</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RemainderError"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#RemainderError"><span class="hs-identifier hs-var">RemainderError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">BSL.ByteString</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Script was successfully parsed, but more (runaway) bytes encountered after script's position</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LedgerLanguageNotAvailableError"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#LedgerLanguageNotAvailableError"><span class="hs-identifier hs-var">LedgerLanguageNotAvailableError</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the plutus version of the given script is not enabled yet</span></span><span>
</span><span id="line-43"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="sdeAffectedLang"><span class="annot"><span class="annottext">ScriptDecodeError -&gt; PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#sdeAffectedLang"><span class="hs-identifier hs-var hs-var">sdeAffectedLang</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the script's ledger language</span></span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="sdeIntroPv"><span class="annot"><span class="annottext">ScriptDecodeError -&gt; ProtocolVersion
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#sdeIntroPv"><span class="hs-identifier hs-var hs-var">sdeIntroPv</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the protocol version that will first introduce/enable the ledger language</span></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="sdeThisPv"><span class="annot"><span class="annottext">ScriptDecodeError -&gt; ProtocolVersion
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#sdeThisPv"><span class="hs-identifier hs-var hs-var">sdeThisPv</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the current protocol version</span></span><span>
</span><span id="line-46"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="PlutusCoreLanguageNotAvailableError"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#PlutusCoreLanguageNotAvailableError"><span class="hs-identifier hs-var">PlutusCoreLanguageNotAvailableError</span></a></span></span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="sdeAffectedVersion"><span class="annot"><span class="annottext">ScriptDecodeError -&gt; Version
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#sdeAffectedVersion"><span class="hs-identifier hs-var hs-var">sdeAffectedVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Version</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the script's Plutus Core language version</span></span><span>
</span><span id="line-49"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="sdeThisPv"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#sdeThisPv"><span class="hs-identifier hs-var">sdeThisPv</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the current protocol version</span></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679927466"><span id="local-6989586621679927480"><span class="annot"><span class="annottext">ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool
(ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool)
-&gt; (ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool)
-&gt; Eq ScriptDecodeError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool
== :: ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool
$c/= :: ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool
/= :: ScriptDecodeError -&gt; ScriptDecodeError -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679927485"><span id="local-6989586621679927504"><span id="local-6989586621679927508"><span class="annot"><span class="annottext">Int -&gt; ScriptDecodeError -&gt; ShowS
[ScriptDecodeError] -&gt; ShowS
ScriptDecodeError -&gt; String
(Int -&gt; ScriptDecodeError -&gt; ShowS)
-&gt; (ScriptDecodeError -&gt; String)
-&gt; ([ScriptDecodeError] -&gt; ShowS)
-&gt; Show ScriptDecodeError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ScriptDecodeError -&gt; ShowS
showsPrec :: Int -&gt; ScriptDecodeError -&gt; ShowS
$cshow :: ScriptDecodeError -&gt; String
show :: ScriptDecodeError -&gt; String
$cshowList :: [ScriptDecodeError] -&gt; ShowS
showList :: [ScriptDecodeError] -&gt; ShowS
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span id="local-6989586621679927516"><span id="local-6989586621679927520"><span id="local-6989586621679927523"><span class="annot"><span class="annottext">Show ScriptDecodeError
Typeable ScriptDecodeError
(Typeable ScriptDecodeError, Show ScriptDecodeError) =&gt;
(ScriptDecodeError -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe ScriptDecodeError)
-&gt; (ScriptDecodeError -&gt; String)
-&gt; Exception ScriptDecodeError
SomeException -&gt; Maybe ScriptDecodeError
ScriptDecodeError -&gt; String
ScriptDecodeError -&gt; SomeException
forall e.
(Typeable e, Show e) =&gt;
(e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e) -&gt; (e -&gt; String) -&gt; Exception e
$ctoException :: ScriptDecodeError -&gt; SomeException
toException :: ScriptDecodeError -&gt; SomeException
$cfromException :: SomeException -&gt; Maybe ScriptDecodeError
fromException :: SomeException -&gt; Maybe ScriptDecodeError
$cdisplayException :: ScriptDecodeError -&gt; String
displayException :: ScriptDecodeError -&gt; String
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></a></span></span></span></span><span>
</span><span id="line-53"></span><span id="AsScriptDecodeError"><span id="local-6989586621679927271"><span id="local-6989586621679927527"><span id="local-6989586621679927537"><span id="local-6989586621679927546"><span id="local-6989586621679927555"><span id="local-6989586621679927565"><span id="local-6989586621679927569"><span id="local-6989586621679927575"><span id="local-6989586621679927581"><span id="local-6989586621679927587"><span id="_ScriptDecodeError"><span id="_CBORDeserialiseError"><span id="_RemainderError"><span id="_LedgerLanguageNotAvailableError"><span id="_PlutusCoreLanguageNotAvailableError"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ScriptDecodeError</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">{- Note [Size checking of constants in PLC programs]
We impose a 64-byte *on-the-wire* limit on the constants inside PLC programs. This prevents people from inserting
Mickey Mouse entire.

This is somewhat inconvenient for users, but they can always send multiple bytestrings and
concatenate them at runtime.

Unfortunately this check was broken in the ledger Plutus language version V1, and so for backwards compatibility
we only perform it in V2 and above.
-}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><span class="hs-comment">-- | Scripts to the ledger are serialised bytestrings.</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">type</span><span> </span><span id="SerialisedScript"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-var">SerialisedScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">{- Note [Using Flat for serialising/deserialising Script]
`plutus-ledger` uses CBOR for data serialisation and `plutus-core` uses Flat. The
choice to use Flat was made to have a more efficient (most wins are in uncompressed
size) data serialisation format and use less space on-chain.

To make `plutus-ledger` work with scripts serialised with Flat, and keep the CBOR
format otherwise, we have defined the `serialiseUPLC` and `uncheckedDeserialiseUPLC` functions.

Because Flat is not self-describing and it gets used in the encoding of Programs,
data structures that include scripts (for example, transactions) no-longer benefit
for CBOR's ability to self-describe it's format.
-}</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Turns a program which was compiled using the \'PlutusTx\' toolchain into</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- a binary format that is understood by the network and can be stored on-chain.</span><span>
</span><span id="line-84"></span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseCompiledCode"><span class="hs-identifier hs-type">serialiseCompiledCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679927302"><span class="annot"><a href="#local-6989586621679927302"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CompiledCode</span></span><span> </span><span class="annot"><a href="#local-6989586621679927302"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span>
</span><span id="line-85"></span><span id="serialiseCompiledCode"><span class="annot"><span class="annottext">serialiseCompiledCode :: forall a. CompiledCode a -&gt; SerialisedScript
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseCompiledCode"><span class="hs-identifier hs-var hs-var">serialiseCompiledCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Program DeBruijn DefaultUni DefaultFun () -&gt; SerialisedScript
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseUPLC"><span class="hs-identifier hs-var">serialiseUPLC</span></a></span><span> </span><span class="annot"><span class="annottext">(Program DeBruijn DefaultUni DefaultFun () -&gt; SerialisedScript)
-&gt; (CompiledCode a -&gt; Program DeBruijn DefaultUni DefaultFun ())
-&gt; CompiledCode a
-&gt; SerialisedScript
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Program NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Program DeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679927625"><span class="hs-identifier hs-var">toNameless</span></a></span><span> </span><span class="annot"><span class="annottext">(Program NamedDeBruijn DefaultUni DefaultFun ()
 -&gt; Program DeBruijn DefaultUni DefaultFun ())
-&gt; (CompiledCode a
    -&gt; Program NamedDeBruijn DefaultUni DefaultFun ())
-&gt; CompiledCode a
-&gt; Program DeBruijn DefaultUni DefaultFun ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledCode a -&gt; Program NamedDeBruijn DefaultUni DefaultFun ()
forall (uni :: * -&gt; *) fun a.
(Closed uni, Everywhere uni Flat, Flat fun) =&gt;
CompiledCodeIn uni fun a -&gt; Program NamedDeBruijn uni fun ()
</span><span class="hs-identifier hs-var">getPlcNoAnn</span></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><a href="#local-6989586621679927625"><span class="hs-identifier hs-type">toNameless</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.DeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>        </span><span id="local-6989586621679927625"><span class="annot"><span class="annottext">toNameless :: Program NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Program DeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679927625"><span class="hs-identifier hs-var hs-var">toNameless</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  (Program NamedDeBruijn DefaultUni DefaultFun ())
  (Program DeBruijn DefaultUni DefaultFun ())
  (Term NamedDeBruijn DefaultUni DefaultFun ())
  (Term DeBruijn DefaultUni DefaultFun ())
-&gt; (Term NamedDeBruijn DefaultUni DefaultFun ()
    -&gt; Term DeBruijn DefaultUni DefaultFun ())
-&gt; Program NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Program DeBruijn DefaultUni DefaultFun ()
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Program NamedDeBruijn DefaultUni DefaultFun ())
  (Program DeBruijn DefaultUni DefaultFun ())
  (Term NamedDeBruijn DefaultUni DefaultFun ())
  (Term DeBruijn DefaultUni DefaultFun ())
forall name1 (uni1 :: * -&gt; *) fun1 ann name2 (uni2 :: * -&gt; *) fun2
       (f :: * -&gt; *).
Functor f =&gt;
(Term name1 uni1 fun1 ann -&gt; f (Term name2 uni2 fun2 ann))
-&gt; Program name1 uni1 fun1 ann -&gt; f (Program name2 uni2 fun2 ann)
</span><span class="hs-identifier hs-var">UPLC.progTerm</span></span><span> </span><span class="annot"><span class="annottext">((Term NamedDeBruijn DefaultUni DefaultFun ()
  -&gt; Term DeBruijn DefaultUni DefaultFun ())
 -&gt; Program NamedDeBruijn DefaultUni DefaultFun ()
 -&gt; Program DeBruijn DefaultUni DefaultFun ())
-&gt; (Term NamedDeBruijn DefaultUni DefaultFun ()
    -&gt; Term DeBruijn DefaultUni DefaultFun ())
-&gt; Program NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Program DeBruijn DefaultUni DefaultFun ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(NamedDeBruijn -&gt; DeBruijn)
-&gt; Term NamedDeBruijn DefaultUni DefaultFun ()
-&gt; Term DeBruijn DefaultUni DefaultFun ()
forall name name' (uni :: * -&gt; *) fun ann.
(name -&gt; name') -&gt; Term name uni fun ann -&gt; Term name' uni fun ann
</span><span class="hs-identifier hs-var">UPLC.termMapNames</span></span><span> </span><span class="annot"><span class="annottext">NamedDeBruijn -&gt; DeBruijn
</span><span class="hs-identifier hs-var">UPLC.unNameDeBruijn</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Turns a program's AST (most likely manually constructed)</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- into a binary format that is understood by the network and can be stored on-chain.</span><span>
</span><span id="line-93"></span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseUPLC"><span class="hs-identifier hs-type">serialiseUPLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.DeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span>
</span><span id="line-94"></span><span id="serialiseUPLC"><span class="annot"><span class="annottext">serialiseUPLC :: Program DeBruijn DefaultUni DefaultFun () -&gt; SerialisedScript
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#serialiseUPLC"><span class="hs-identifier hs-var hs-var">serialiseUPLC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-comment">-- See Note [Using Flat for serialising/deserialising Script]</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-comment">-- Currently, this is off because the old implementation didn't actually work, so we need to be careful</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- about introducing a working version</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; SerialisedScript
</span><span class="hs-identifier hs-var">toShort</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; SerialisedScript)
-&gt; (Program DeBruijn DefaultUni DefaultFun () -&gt; ByteString)
-&gt; Program DeBruijn DefaultUni DefaultFun ()
-&gt; SerialisedScript
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BSL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (Program DeBruijn DefaultUni DefaultFun () -&gt; ByteString)
-&gt; Program DeBruijn DefaultUni DefaultFun ()
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SerialiseViaFlat
  (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
-&gt; ByteString
forall a. Serialise a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialise</span></span><span> </span><span class="annot"><span class="annottext">(SerialiseViaFlat
   (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
 -&gt; ByteString)
-&gt; (Program DeBruijn DefaultUni DefaultFun ()
    -&gt; SerialiseViaFlat
         (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()))
-&gt; Program DeBruijn DefaultUni DefaultFun ()
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()
-&gt; SerialiseViaFlat
     (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
forall a. a -&gt; SerialiseViaFlat a
</span><a href="Codec.CBOR.Extras.html#SerialiseViaFlat"><span class="hs-identifier hs-var">SerialiseViaFlat</span></a></span><span> </span><span class="annot"><span class="annottext">(UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()
 -&gt; SerialiseViaFlat
      (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()))
-&gt; (Program DeBruijn DefaultUni DefaultFun ()
    -&gt; UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
-&gt; Program DeBruijn DefaultUni DefaultFun ()
-&gt; SerialiseViaFlat
     (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Program DeBruijn DefaultUni DefaultFun ()
-&gt; UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()
forall name (uni :: * -&gt; *) fun ann.
Program name uni fun ann -&gt; UnrestrictedProgram name uni fun ann
</span><span class="hs-identifier hs-var">UPLC.UnrestrictedProgram</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Deserialises a 'SerialisedScript' back into an AST. Does *not* do ledger-language-version-specific</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- checks like for allowable builtins.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#uncheckedDeserialiseUPLC"><span class="hs-identifier hs-type">uncheckedDeserialiseUPLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.DeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="uncheckedDeserialiseUPLC"><span class="annot"><span class="annottext">uncheckedDeserialiseUPLC :: SerialisedScript -&gt; Program DeBruijn DefaultUni DefaultFun ()
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#uncheckedDeserialiseUPLC"><span class="hs-identifier hs-var hs-var">uncheckedDeserialiseUPLC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialiseViaFlat
  (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
-&gt; Program DeBruijn DefaultUni DefaultFun ()
forall {name} {uni :: * -&gt; *} {fun} {ann}.
SerialiseViaFlat (UnrestrictedProgram name uni fun ann)
-&gt; Program name uni fun ann
</span><a href="#local-6989586621679927635"><span class="hs-identifier hs-var">unSerialiseViaFlat</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialiseViaFlat
   (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
 -&gt; Program DeBruijn DefaultUni DefaultFun ())
-&gt; (SerialisedScript
    -&gt; SerialiseViaFlat
         (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()))
-&gt; SerialisedScript
-&gt; Program DeBruijn DefaultUni DefaultFun ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; SerialiseViaFlat
     (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
forall a. Serialise a =&gt; ByteString -&gt; a
</span><span class="hs-identifier hs-var">deserialise</span></span><span> </span><span class="annot"><span class="annottext">(ByteString
 -&gt; SerialiseViaFlat
      (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ()))
-&gt; (SerialisedScript -&gt; ByteString)
-&gt; SerialisedScript
-&gt; SerialiseViaFlat
     (UnrestrictedProgram DeBruijn DefaultUni DefaultFun ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BSL.fromStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (SerialisedScript -&gt; ByteString)
-&gt; SerialisedScript
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; ByteString
</span><span class="hs-identifier hs-var">fromShort</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679927635"><span class="annot"><span class="annottext">unSerialiseViaFlat :: SerialiseViaFlat (UnrestrictedProgram name uni fun ann)
-&gt; Program name uni fun ann
</span><a href="#local-6989586621679927635"><span class="hs-identifier hs-var hs-var">unSerialiseViaFlat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.CBOR.Extras.html#SerialiseViaFlat"><span class="hs-identifier hs-type">SerialiseViaFlat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.UnrestrictedProgram</span></span><span> </span><span id="local-6989586621679927638"><span class="annot"><span class="annottext">Program name uni fun ann
</span><a href="#local-6989586621679927638"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Program name uni fun ann
</span><a href="#local-6989586621679927638"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><span class="hs-comment">-- | A variant of `Script` with a specialized decoder.</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">newtype</span><span> </span><span id="ScriptForExecution"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-var">ScriptForExecution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScriptForExecution"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-var">ScriptForExecution</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">{-| This decoder decodes the names directly into `NamedDeBruijn`s rather than `DeBruijn`s.
This is needed because the CEK machine expects `NameDeBruijn`s, but there are obviously no names in the serialised form of a `Script`.
Rather than traversing the term and inserting fake names after deserialising, this lets us do at the same time as deserialising.
-}</span></span><span>
</span><span id="line-114"></span><span id="local-6989586621679927346"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#scriptCBORDecoder"><span class="hs-identifier hs-type">scriptCBORDecoder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679927346"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-type">ScriptForExecution</span></a></span></span><span>
</span><span id="line-115"></span><span id="scriptCBORDecoder"><span class="annot"><span class="annottext">scriptCBORDecoder :: forall s.
PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; Decoder s ScriptForExecution
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#scriptCBORDecoder"><span class="hs-identifier hs-var hs-var">scriptCBORDecoder</span></a></span></span><span> </span><span id="local-6989586621679927647"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927647"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679927648"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927648"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- See Note [New builtins and protocol versions]</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679927649"><span class="annot"><span class="annottext">availableBuiltins :: Set DefaultFun
</span><a href="#local-6989586621679927649"><span class="hs-identifier hs-var hs-var">availableBuiltins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; ProtocolVersion -&gt; Set DefaultFun
</span><a href="PlutusLedgerApi.Common.Versions.html#builtinsAvailableIn"><span class="hs-identifier hs-var">builtinsAvailableIn</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927647"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927648"><span class="hs-identifier hs-var">pv</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span id="local-6989586621679927659"><span class="annot"><span class="annottext">flatDecoder :: Get (Program FakeNamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679927659"><span class="hs-identifier hs-var hs-var">flatDecoder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DefaultFun -&gt; Maybe String)
-&gt; Get (Program FakeNamedDeBruijn DefaultUni DefaultFun ())
forall name (uni :: * -&gt; *) fun ann.
(Closed uni, Everywhere uni Flat, Flat fun, Flat ann, Flat name,
 Flat (Binder name)) =&gt;
(fun -&gt; Maybe String) -&gt; Get (Program name uni fun ann)
</span><span class="hs-identifier hs-var">UPLC.decodeProgram</span></span><span> </span><span class="annot"><span class="annottext">DefaultFun -&gt; Maybe String
</span><a href="#local-6989586621679927661"><span class="hs-identifier hs-var">checkBuiltin</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-comment">-- TODO: optimize this by using a better datastructure e.g. 'IntSet'</span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679927661"><span class="annot"><span class="annottext">checkBuiltin :: DefaultFun -&gt; Maybe String
</span><a href="#local-6989586621679927661"><span class="hs-identifier hs-var hs-var">checkBuiltin</span></a></span></span><span> </span><span id="local-6989586621679927673"><span class="annot"><span class="annottext">DefaultFun
</span><a href="#local-6989586621679927673"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DefaultFun
</span><a href="#local-6989586621679927673"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultFun -&gt; Set DefaultFun -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set DefaultFun
</span><a href="#local-6989586621679927649"><span class="hs-identifier hs-var">availableBuiltins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><a href="#local-6989586621679927661"><span class="hs-identifier hs-var">checkBuiltin</span></a></span><span> </span><span id="local-6989586621679927675"><span class="annot"><span class="annottext">DefaultFun
</span><a href="#local-6989586621679927675"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe String) -&gt; String -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Builtin function &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultFun -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultFun
</span><a href="#local-6989586621679927675"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not available in language &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. PlutusLedgerLanguage -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927647"><span class="hs-identifier hs-var">lv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; at and protocol version &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolVersion -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. ProtocolVersion -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927648"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-comment">-- Deserialise using 'FakeNamedDeBruijn' to get the fake names added</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679927678"><span class="annot"><span class="annottext">Program FakeNamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679927678"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UPLC.FakeNamedDeBruijn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefaultFun</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Get (Program FakeNamedDeBruijn DefaultUni DefaultFun ())
-&gt; Decoder s (Program FakeNamedDeBruijn DefaultUni DefaultFun ())
forall a s. Get a -&gt; Decoder s a
</span><a href="Codec.CBOR.Extras.html#decodeViaFlat"><span class="hs-identifier hs-var">decodeViaFlat</span></a></span><span> </span><span class="annot"><span class="annottext">Get (Program FakeNamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679927659"><span class="hs-identifier hs-var">flatDecoder</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">ScriptForExecution -&gt; Decoder s ScriptForExecution
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptForExecution -&gt; Decoder s ScriptForExecution)
-&gt; ScriptForExecution -&gt; Decoder s ScriptForExecution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Program FakeNamedDeBruijn DefaultUni DefaultFun ()
-&gt; ScriptForExecution
forall a b. Coercible a b =&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Prim.html#coerce"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">Program FakeNamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679927678"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | The deserialization from a serialised script to a Script (for execution).</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- Called inside phase-1 validation (assertScriptWellFormed) and inside phase-2's `mkTermToEvaluate`</span><span>
</span><span id="line-129"></span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#fromSerialisedScript"><span class="hs-identifier hs-type">fromSerialisedScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679927371"><span class="annot"><a href="#local-6989586621679927371"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679927372"><span class="annot"><a href="#local-6989586621679927372"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier hs-type">AsScriptDecodeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679927371"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679927371"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679927372"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the Plutus ledger language of the script.</span></span><span>
</span><span id="line-131"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ which protocol version the script was submitted in.</span></span><span>
</span><span id="line-132"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the script to deserialise.</span></span><span>
</span><span id="line-133"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679927372"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-type">ScriptForExecution</span></a></span><span>
</span><span id="line-134"></span><span id="fromSerialisedScript"><span class="annot"><span class="annottext">fromSerialisedScript :: forall e (m :: * -&gt; *).
(AsScriptDecodeError e, MonadError e m) =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; SerialisedScript -&gt; m ScriptForExecution
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#fromSerialisedScript"><span class="hs-identifier hs-var hs-var">fromSerialisedScript</span></a></span></span><span> </span><span id="local-6989586621679927718"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679927719"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927719"><span class="hs-identifier hs-var">currentPv</span></a></span></span><span> </span><span id="local-6989586621679927720"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679927720"><span class="hs-identifier hs-var">sScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- check that the ledger language version is available</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679927721"><span class="annot"><span class="annottext">llIntroPv :: ProtocolVersion
</span><a href="#local-6989586621679927721"><span class="hs-identifier hs-var hs-var">llIntroPv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; ProtocolVersion
</span><a href="PlutusLedgerApi.Common.Versions.html#ledgerLanguageIntroducedIn"><span class="hs-identifier hs-var">ledgerLanguageIntroducedIn</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927721"><span class="hs-identifier hs-var">llIntroPv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion -&gt; ProtocolVersion -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927719"><span class="hs-identifier hs-var">currentPv</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">AReview e ScriptDecodeError -&gt; ScriptDecodeError -&gt; m ()
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e ScriptDecodeError
forall r. AsScriptDecodeError r =&gt; Prism' r ScriptDecodeError
Prism' e ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#_ScriptDecodeError"><span class="hs-identifier hs-var">_ScriptDecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptDecodeError -&gt; m ()) -&gt; ScriptDecodeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; ProtocolVersion -&gt; ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#LedgerLanguageNotAvailableError"><span class="hs-identifier hs-var">LedgerLanguageNotAvailableError</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927721"><span class="hs-identifier hs-var">llIntroPv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927719"><span class="hs-identifier hs-var">currentPv</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679927725"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679927725"><span class="hs-identifier hs-var">remderBS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679927726"><span class="annot"><span class="annottext">script :: ScriptForExecution
</span><a href="#local-6989586621679927726"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-type">ScriptForExecution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UPLC.Program</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; m (ByteString, ScriptForExecution)
</span><a href="#local-6989586621679927728"><span class="hs-identifier hs-var">deserialiseSScript</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679927720"><span class="hs-identifier hs-var">sScript</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; PlutusLedgerLanguage -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.Versions.html#PlutusV1"><span class="hs-identifier hs-var">PlutusV1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; PlutusLedgerLanguage -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="PlutusLedgerApi.Common.Versions.html#PlutusV2"><span class="hs-identifier hs-var">PlutusV2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679927725"><span class="hs-identifier hs-var">remderBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">AReview e ScriptDecodeError -&gt; ScriptDecodeError -&gt; m ()
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e ScriptDecodeError
forall r. AsScriptDecodeError r =&gt; Prism' r ScriptDecodeError
Prism' e ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#_ScriptDecodeError"><span class="hs-identifier hs-var">_ScriptDecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptDecodeError -&gt; m ()) -&gt; ScriptDecodeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#RemainderError"><span class="hs-identifier hs-var">RemainderError</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679927725"><span class="hs-identifier hs-var">remderBS</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">ScriptForExecution -&gt; m ScriptForExecution
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptForExecution
</span><a href="#local-6989586621679927726"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="#local-6989586621679927728"><span class="hs-identifier hs-type">deserialiseSScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679927372"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BSL.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-type">ScriptForExecution</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621679927728"><span class="annot"><span class="annottext">deserialiseSScript :: SerialisedScript -&gt; m (ByteString, ScriptForExecution)
</span><a href="#local-6989586621679927728"><span class="hs-identifier hs-var hs-var">deserialiseSScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; ByteString
</span><span class="hs-identifier hs-var">fromShort</span></span><span>
</span><span id="line-148"></span><span>                       </span><span class="annot"><span class="annottext">(SerialisedScript -&gt; ByteString)
-&gt; (ByteString -&gt; m (ByteString, ScriptForExecution))
-&gt; SerialisedScript
-&gt; m (ByteString, ScriptForExecution)
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator hs-var">&gt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">fromStrict</span></span><span>
</span><span id="line-149"></span><span>                       </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; m (ByteString, ScriptForExecution))
-&gt; ByteString
-&gt; m (ByteString, ScriptForExecution)
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator hs-var">&gt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s ScriptForExecution)
-&gt; ByteString
-&gt; Either DeserialiseFailure (ByteString, ScriptForExecution)
forall a.
(forall s. Decoder s a)
-&gt; ByteString -&gt; Either DeserialiseFailure (ByteString, a)
</span><span class="hs-identifier hs-var">CBOR.deserialiseFromBytes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; Decoder s ScriptForExecution
forall s.
PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; Decoder s ScriptForExecution
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#scriptCBORDecoder"><span class="hs-identifier hs-var">scriptCBORDecoder</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927718"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927719"><span class="hs-identifier hs-var">currentPv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>                       </span><span class="hs-comment">-- lift the underlying cbor error to our custom error</span><span>
</span><span id="line-151"></span><span>                       </span><span class="annot"><span class="annottext">(ByteString
 -&gt; Either DeserialiseFailure (ByteString, ScriptForExecution))
-&gt; (Either DeserialiseFailure (ByteString, ScriptForExecution)
    -&gt; m (ByteString, ScriptForExecution))
-&gt; ByteString
-&gt; m (ByteString, ScriptForExecution)
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator hs-var">&gt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(DeserialiseFailure -&gt; m (ByteString, ScriptForExecution))
-&gt; ((ByteString, ScriptForExecution)
    -&gt; m (ByteString, ScriptForExecution))
-&gt; Either DeserialiseFailure (ByteString, ScriptForExecution)
-&gt; m (ByteString, ScriptForExecution)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AReview e ScriptDecodeError
-&gt; ScriptDecodeError -&gt; m (ByteString, ScriptForExecution)
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e ScriptDecodeError
forall r. AsScriptDecodeError r =&gt; Prism' r ScriptDecodeError
Prism' e ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#_ScriptDecodeError"><span class="hs-identifier hs-var">_ScriptDecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptDecodeError -&gt; m (ByteString, ScriptForExecution))
-&gt; (DeserialiseFailure -&gt; ScriptDecodeError)
-&gt; DeserialiseFailure
-&gt; m (ByteString, ScriptForExecution)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DeserialiseFailure -&gt; ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#CBORDeserialiseError"><span class="hs-identifier hs-var">CBORDeserialiseError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString, ScriptForExecution)
-&gt; m (ByteString, ScriptForExecution)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-comment">{-| Check if a 'Script' is &quot;valid&quot; according to a protocol version. At the moment this means &quot;deserialises correctly&quot;, which in particular
implies that it is (almost certainly) an encoded script and the script does not mention any builtins unavailable in the given protocol version.

Note: Parameterized over the ledger-plutus-version since the builtins allowed (during decoding) differs.
-}</span></span><span>
</span><span id="line-158"></span><span id="local-6989586621679927400"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#assertScriptWellFormed"><span class="hs-identifier hs-type">assertScriptWellFormed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptDecodeError"><span class="hs-identifier hs-type">ScriptDecodeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679927400"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-159"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the ledger Plutus version of the script.</span></span><span>
</span><span id="line-160"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the current protocol version of the network</span></span><span>
</span><span id="line-161"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the script to check for well-formedness</span></span><span>
</span><span id="line-162"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679927400"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-163"></span><span id="assertScriptWellFormed"><span class="annot"><span class="annottext">assertScriptWellFormed :: forall (m :: * -&gt; *).
MonadError ScriptDecodeError m =&gt;
PlutusLedgerLanguage -&gt; ProtocolVersion -&gt; SerialisedScript -&gt; m ()
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#assertScriptWellFormed"><span class="hs-identifier hs-var hs-var">assertScriptWellFormed</span></a></span></span><span> </span><span id="local-6989586621679927743"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927743"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679927744"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927744"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- We opt to throw away the ScriptExecution result. for not &quot;leaking&quot; the actual Script through the API.</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">m ScriptForExecution -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">(m ScriptForExecution -&gt; m ())
-&gt; (SerialisedScript -&gt; m ScriptForExecution)
-&gt; SerialisedScript
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; SerialisedScript -&gt; m ScriptForExecution
forall e (m :: * -&gt; *).
(AsScriptDecodeError e, MonadError e m) =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; SerialisedScript -&gt; m ScriptForExecution
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#fromSerialisedScript"><span class="hs-identifier hs-var">fromSerialisedScript</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679927743"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679927744"><span class="hs-identifier hs-var">pv</span></a></span><span>
</span><span id="line-167"></span></pre></body></html>